{"version":3,"sources":["../../../src/cloudinary/services/cloudinary.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { UploadApiErrorResponse, UploadApiResponse, v2 } from 'cloudinary';\r\nimport { Readable } from 'stream';\r\n\r\n@Injectable()\r\nexport class CloudinaryService {\r\n  async uploadImage(\r\n    file: Express.Multer.File,\r\n  ): Promise<UploadApiResponse | UploadApiErrorResponse> {\r\n    return new Promise((resolve, reject) => {\r\n      const upload = v2.uploader.upload_stream(\r\n        { folder: 'ecommerce' },\r\n        (error, result) => {\r\n          if (error) {\r\n            console.error('Cloudinary upload error:', error);\r\n            return reject(error);\r\n          }\r\n          resolve(result as any);\r\n        },\r\n      );\r\n\r\n      const stream = Readable.from(file.buffer);\r\n      stream.pipe(upload);\r\n    });\r\n  }\r\n\r\n  async uploadImages(images: string[]): Promise<string[]> {\r\n    const uploadPromises = images.map(async imageUrl => {\r\n      const response = await fetch(imageUrl);\r\n      const buffer = Buffer.from(await response.arrayBuffer());\r\n\r\n      return new Promise<string>((resolve, reject) => {\r\n        const upload = v2.uploader.upload_stream(\r\n          { folder: 'products' },\r\n          (error, result) => {\r\n            if (error) {\r\n              console.error('Cloudinary upload error:', error);\r\n              return reject(error);\r\n            }\r\n            resolve(result?.secure_url || '');\r\n          },\r\n        );\r\n\r\n        const stream = Readable.from(buffer);\r\n        stream.pipe(upload);\r\n      });\r\n    });\r\n\r\n    return Promise.all(uploadPromises);\r\n  }\r\n\r\n  async uploadBuffer(buffer: Buffer): Promise<string> {\r\n    return new Promise((resolve, reject) => {\r\n      const upload = v2.uploader.upload_stream(\r\n        { folder: 'products' },\r\n        (error, result) => {\r\n          if (error) {\r\n            console.error('Cloudinary upload error:', error);\r\n            return reject(error);\r\n          }\r\n          resolve(result?.secure_url || '');\r\n        },\r\n      );\r\n\r\n      const stream = Readable.from(buffer);\r\n      stream.pipe(upload);\r\n    });\r\n  }\r\n}\r\n"],"names":["CloudinaryService","uploadImage","file","Promise","resolve","reject","upload","v2","uploader","upload_stream","folder","error","result","console","stream","Readable","from","buffer","pipe","uploadImages","images","uploadPromises","map","imageUrl","response","fetch","Buffer","arrayBuffer","secure_url","all","uploadBuffer"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBALc;4BACmC;wBACrC;;;;;;;AAGlB,IAAA,AAAMA,oBAAN,MAAMA;IACX,MAAMC,YACJC,IAAyB,EAC4B;QACrD,OAAO,IAAIC,QAAQ,CAACC,SAASC;YAC3B,MAAMC,SAASC,cAAE,CAACC,QAAQ,CAACC,aAAa,CACtC;gBAAEC,QAAQ;YAAY,GACtB,CAACC,OAAOC;gBACN,IAAID,OAAO;oBACTE,QAAQF,KAAK,CAAC,4BAA4BA;oBAC1C,OAAON,OAAOM;gBAChB;gBACAP,QAAQQ;YACV;YAGF,MAAME,SAASC,gBAAQ,CAACC,IAAI,CAACd,KAAKe,MAAM;YACxCH,OAAOI,IAAI,CAACZ;QACd;IACF;IAEA,MAAMa,aAAaC,MAAgB,EAAqB;QACtD,MAAMC,iBAAiBD,OAAOE,GAAG,CAAC,OAAMC;YACtC,MAAMC,WAAW,MAAMC,MAAMF;YAC7B,MAAMN,SAASS,OAAOV,IAAI,CAAC,MAAMQ,SAASG,WAAW;YAErD,OAAO,IAAIxB,QAAgB,CAACC,SAASC;gBACnC,MAAMC,SAASC,cAAE,CAACC,QAAQ,CAACC,aAAa,CACtC;oBAAEC,QAAQ;gBAAW,GACrB,CAACC,OAAOC;oBACN,IAAID,OAAO;wBACTE,QAAQF,KAAK,CAAC,4BAA4BA;wBAC1C,OAAON,OAAOM;oBAChB;oBACAP,QAAQQ,QAAQgB,cAAc;gBAChC;gBAGF,MAAMd,SAASC,gBAAQ,CAACC,IAAI,CAACC;gBAC7BH,OAAOI,IAAI,CAACZ;YACd;QACF;QAEA,OAAOH,QAAQ0B,GAAG,CAACR;IACrB;IAEA,MAAMS,aAAab,MAAc,EAAmB;QAClD,OAAO,IAAId,QAAQ,CAACC,SAASC;YAC3B,MAAMC,SAASC,cAAE,CAACC,QAAQ,CAACC,aAAa,CACtC;gBAAEC,QAAQ;YAAW,GACrB,CAACC,OAAOC;gBACN,IAAID,OAAO;oBACTE,QAAQF,KAAK,CAAC,4BAA4BA;oBAC1C,OAAON,OAAOM;gBAChB;gBACAP,QAAQQ,QAAQgB,cAAc;YAChC;YAGF,MAAMd,SAASC,gBAAQ,CAACC,IAAI,CAACC;YAC7BH,OAAOI,IAAI,CAACZ;QACd;IACF;AACF"}