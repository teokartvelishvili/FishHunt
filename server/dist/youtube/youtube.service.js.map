{"version":3,"sources":["../../src/youtube/youtube.service.ts"],"sourcesContent":["import { Injectable, Logger, HttpException, HttpStatus } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { google, youtube_v3 } from 'googleapis';\r\nimport { OAuth2Client } from 'google-auth-library';\r\nimport * as fs from 'fs';\r\nimport * as path from 'path';\r\n\r\nexport interface VideoUploadOptions {\r\n  title: string;\r\n  description: string;\r\n  tags?: string[];\r\n  categoryId?: string; // YouTube category ID (e.g., \"22\" for People & Blogs)\r\n  privacyStatus?: 'public' | 'private' | 'unlisted';\r\n}\r\n\r\n@Injectable()\r\nexport class YoutubeService {\r\n  private readonly logger = new Logger(YoutubeService.name);\r\n  private oauth2Client: OAuth2Client;\r\n  private youtube: youtube_v3.Youtube;\r\n\r\n  constructor(private configService: ConfigService) {\r\n    this.initializeOAuth();\r\n  }\r\n\r\n  /**\r\n   * OAuth2 Client-ის ინიციალიზაცია\r\n   */\r\n  private initializeOAuth() {\r\n    const clientId = this.configService.get<string>('YOUTUBE_CLIENT_ID');\r\n    const clientSecret = this.configService.get<string>(\r\n      'YOUTUBE_CLIENT_SECRET',\r\n    );\r\n    const redirectUri = this.configService.get<string>('YOUTUBE_REDIRECT_URI');\r\n\r\n    if (!clientId || !clientSecret || !redirectUri) {\r\n      this.logger.warn('YouTube API credentials are not configured');\r\n      return;\r\n    }\r\n\r\n    this.oauth2Client = new google.auth.OAuth2(\r\n      clientId,\r\n      clientSecret,\r\n      redirectUri,\r\n    );\r\n\r\n    // Refresh Token-ის დატვირთვა\r\n    const refreshToken = this.configService.get<string>(\r\n      'YOUTUBE_REFRESH_TOKEN',\r\n    );\r\n    if (refreshToken) {\r\n      this.oauth2Client.setCredentials({\r\n        refresh_token: refreshToken,\r\n      });\r\n    }\r\n\r\n    this.youtube = google.youtube({\r\n      version: 'v3',\r\n      auth: this.oauth2Client,\r\n    });\r\n\r\n    this.logger.log('YouTube API initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Ensures OAuth client და youtube SDK მზადაა სანამ მოთხოვნას შევასრულებთ\r\n   */\r\n  private ensureYoutubeClient() {\r\n    if (!this.oauth2Client || !this.youtube) {\r\n      this.initializeOAuth();\r\n    }\r\n\r\n    if (!this.oauth2Client || !this.youtube) {\r\n      this.logger.error(\r\n        'YouTube API is not initialized. Check environment variables.',\r\n      );\r\n      throw new HttpException(\r\n        'YouTube API credentials are not configured on the server',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Authorization URL-ის გენერირება\r\n   * პირველადი ავტორიზაციისთვის\r\n   */\r\n  getAuthUrl(): string {\r\n    this.ensureYoutubeClient();\r\n    const scopes = [\r\n      'https://www.googleapis.com/auth/youtube.upload',\r\n      'https://www.googleapis.com/auth/youtube',\r\n      'https://www.googleapis.com/auth/youtube.force-ssl',\r\n    ];\r\n\r\n    return this.oauth2Client.generateAuthUrl({\r\n      access_type: 'offline',\r\n      scope: scopes,\r\n      prompt: 'consent', // Force consent screen to get refresh token\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Authorization Code-ით Token-ის მიღება\r\n   */\r\n  async getTokenFromCode(code: string): Promise<any> {\r\n    this.ensureYoutubeClient();\r\n    try {\r\n      const { tokens } = await this.oauth2Client.getToken(code);\r\n      this.oauth2Client.setCredentials(tokens);\r\n\r\n      this.logger.log('Tokens received successfully');\r\n      this.logger.log('Refresh Token:', tokens.refresh_token);\r\n\r\n      return tokens;\r\n    } catch (error) {\r\n      this.logger.error('Error getting tokens:', error);\r\n      throw new HttpException(\r\n        'Failed to get authentication tokens',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ვიდეოს ატვირთვა YouTube-ზე\r\n   * @param filePath - ვიდეო ფაილის path\r\n   * @param options - ვიდეოს metadata\r\n   * @returns YouTube video URL\r\n   */\r\n  async uploadVideo(\r\n    filePath: string,\r\n    options: VideoUploadOptions,\r\n  ): Promise<{ videoId: string; videoUrl: string; embedUrl: string }> {\r\n    try {\r\n      this.ensureYoutubeClient();\r\n      if (!fs.existsSync(filePath)) {\r\n        throw new HttpException('Video file not found', HttpStatus.NOT_FOUND);\r\n      }\r\n\r\n      this.logger.log(`Starting upload for: ${options.title}`);\r\n\r\n      const fileSize = fs.statSync(filePath).size;\r\n      const fileSizeInMB = (fileSize / (1024 * 1024)).toFixed(2);\r\n      this.logger.log(`File size: ${fileSizeInMB} MB`);\r\n\r\n      // ვიდეოს metadata\r\n      const videoMetadata = {\r\n        snippet: {\r\n          title: options.title,\r\n          description: options.description,\r\n          tags: options.tags || [],\r\n          categoryId: options.categoryId || '22', // Default: People & Blogs\r\n        },\r\n        status: {\r\n          privacyStatus: options.privacyStatus || 'public',\r\n          selfDeclaredMadeForKids: false,\r\n        },\r\n      };\r\n\r\n      // ვიდეოს ატვირთვა\r\n      const response = await this.youtube.videos.insert({\r\n        part: ['snippet', 'status'],\r\n        requestBody: videoMetadata,\r\n        media: {\r\n          body: fs.createReadStream(filePath),\r\n        },\r\n      });\r\n\r\n      const videoId = response.data.id;\r\n      const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;\r\n      const embedUrl = `https://www.youtube.com/embed/${videoId}`;\r\n\r\n      this.logger.log(`Video uploaded successfully: ${videoUrl}`);\r\n\r\n      // Playlist-ში დამატება\r\n      const playlistId = this.configService.get<string>('YOUTUBE_PLAYLIST_ID');\r\n      if (playlistId) {\r\n        await this.addVideoToPlaylist(videoId, playlistId);\r\n      }\r\n\r\n      return {\r\n        videoId,\r\n        videoUrl,\r\n        embedUrl,\r\n      };\r\n    } catch (error) {\r\n      this.logger.error('Error uploading video:', error);\r\n      throw new HttpException(\r\n        `Failed to upload video: ${error.message}`,\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ვიდეოს Playlist-ში დამატება\r\n   */\r\n  async addVideoToPlaylist(videoId: string, playlistId: string): Promise<void> {\r\n    try {\r\n      this.ensureYoutubeClient();\r\n      await this.youtube.playlistItems.insert({\r\n        part: ['snippet'],\r\n        requestBody: {\r\n          snippet: {\r\n            playlistId: playlistId,\r\n            resourceId: {\r\n              kind: 'youtube#video',\r\n              videoId: videoId,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      this.logger.log(`Video added to playlist: ${playlistId}`);\r\n    } catch (error) {\r\n      this.logger.error('Error adding video to playlist:', error);\r\n      // არ ვიყენებთ throw-ს რომ არ გავშალოთ მთელი upload process\r\n      // თუ playlist-ში დამატება ვერ მოხერხდა\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Playlist-ის შექმნა\r\n   */\r\n  async createPlaylist(\r\n    title: string,\r\n    description: string,\r\n    privacyStatus: 'public' | 'private' | 'unlisted' = 'public',\r\n  ): Promise<string> {\r\n    try {\r\n      this.ensureYoutubeClient();\r\n      const response = await this.youtube.playlists.insert({\r\n        part: ['snippet', 'status'],\r\n        requestBody: {\r\n          snippet: {\r\n            title,\r\n            description,\r\n          },\r\n          status: {\r\n            privacyStatus,\r\n          },\r\n        },\r\n      });\r\n\r\n      const playlistId = response.data.id;\r\n      this.logger.log(`Playlist created: ${playlistId}`);\r\n      return playlistId;\r\n    } catch (error) {\r\n      this.logger.error('Error creating playlist:', error);\r\n      throw new HttpException(\r\n        'Failed to create playlist',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * არხის ინფორმაციის მიღება\r\n   */\r\n  async getChannelInfo(): Promise<any> {\r\n    try {\r\n      this.ensureYoutubeClient();\r\n      const response = await this.youtube.channels.list({\r\n        part: ['snippet', 'contentDetails', 'statistics'],\r\n        mine: true,\r\n      });\r\n\r\n      return response.data.items?.[0] || null;\r\n    } catch (error) {\r\n      this.logger.error('Error getting channel info:', error);\r\n      throw new HttpException(\r\n        'Failed to get channel info',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ვიდეოს წაშლა\r\n   */\r\n  async deleteVideo(videoId: string): Promise<void> {\r\n    try {\r\n      this.ensureYoutubeClient();\r\n      await this.youtube.videos.delete({\r\n        id: videoId,\r\n      });\r\n\r\n      this.logger.log(`Video deleted: ${videoId}`);\r\n    } catch (error) {\r\n      this.logger.error('Error deleting video:', error);\r\n      throw new HttpException(\r\n        'Failed to delete video',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ვიდეოს განახლება\r\n   */\r\n  async updateVideo(\r\n    videoId: string,\r\n    updates: Partial<VideoUploadOptions>,\r\n  ): Promise<void> {\r\n    try {\r\n      this.ensureYoutubeClient();\r\n      const updateData: any = {\r\n        id: videoId,\r\n      };\r\n\r\n      if (updates.title || updates.description || updates.tags) {\r\n        updateData.snippet = {};\r\n        if (updates.title) updateData.snippet.title = updates.title;\r\n        if (updates.description)\r\n          updateData.snippet.description = updates.description;\r\n        if (updates.tags) updateData.snippet.tags = updates.tags;\r\n      }\r\n\r\n      if (updates.privacyStatus) {\r\n        updateData.status = {\r\n          privacyStatus: updates.privacyStatus,\r\n        };\r\n      }\r\n\r\n      await this.youtube.videos.update({\r\n        part: ['snippet', 'status'],\r\n        requestBody: updateData,\r\n      });\r\n\r\n      this.logger.log(`Video updated: ${videoId}`);\r\n    } catch (error) {\r\n      this.logger.error('Error updating video:', error);\r\n      throw new HttpException(\r\n        'Failed to update video',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n}\r\n"],"names":["YoutubeService","initializeOAuth","clientId","configService","get","clientSecret","redirectUri","logger","warn","oauth2Client","google","auth","OAuth2","refreshToken","setCredentials","refresh_token","youtube","version","log","ensureYoutubeClient","error","HttpException","HttpStatus","INTERNAL_SERVER_ERROR","getAuthUrl","scopes","generateAuthUrl","access_type","scope","prompt","getTokenFromCode","code","tokens","getToken","uploadVideo","filePath","options","fs","existsSync","NOT_FOUND","title","fileSize","statSync","size","fileSizeInMB","toFixed","videoMetadata","snippet","description","tags","categoryId","status","privacyStatus","selfDeclaredMadeForKids","response","videos","insert","part","requestBody","media","body","createReadStream","videoId","data","id","videoUrl","embedUrl","playlistId","addVideoToPlaylist","message","playlistItems","resourceId","kind","createPlaylist","playlists","getChannelInfo","channels","list","mine","items","deleteVideo","delete","updateVideo","updates","updateData","update","Logger","name"],"mappings":"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"}