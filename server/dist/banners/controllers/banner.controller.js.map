{"version":3,"sources":["../../../src/banners/controllers/banner.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Patch,\r\n  Param,\r\n  Delete,\r\n  UseGuards,\r\n  UploadedFiles,\r\n  UseInterceptors,\r\n  HttpException,\r\n  HttpStatus,\r\n} from '@nestjs/common';\r\nimport { FilesInterceptor } from '@nestjs/platform-express';\r\nimport { BannerService } from '../services/banner.service';\r\nimport { CreateBannerDto, UpdateBannerDto } from '../dtos/banner.dto';\r\nimport { JwtAuthGuard } from '../../guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../../guards/roles.guard';\r\nimport { Roles } from '../../decorators/roles.decorator';\r\nimport { Role } from '../../types/role.enum';\r\nimport { AppService } from '../../app/services/app.service';\r\n\r\n@Controller('banners')\r\nexport class BannerController {\r\n  constructor(\r\n    private readonly bannerService: BannerService,\r\n    private readonly appService: AppService,\r\n  ) {}\r\n\r\n  @Post()\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles(Role.Admin)\r\n  @UseInterceptors(FilesInterceptor('images', 1)) // Allow only 1 image per banner\r\n  async create(\r\n    @Body() createBannerDto: CreateBannerDto,\r\n    @UploadedFiles() images?: Express.Multer.File[],\r\n  ) {\r\n    try {\r\n      let imageUrl = '';\r\n\r\n      if (images && images.length > 0) {\r\n        // Upload image to Cloudinary with banner optimization\r\n        imageUrl = await this.appService.uploadBannerImageToCloudinary(\r\n          images[0],\r\n        );\r\n      }\r\n\r\n      const banner = await this.bannerService.create({\r\n        ...createBannerDto,\r\n        imageUrl: imageUrl,\r\n      });\r\n\r\n      return banner;\r\n    } catch (error) {\r\n      throw new HttpException(\r\n        error.message || 'Error creating banner',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  @Get()\r\n  async findAll() {\r\n    return this.bannerService.findAll();\r\n  }\r\n\r\n  @Get('active')\r\n  async findActive() {\r\n    return this.bannerService.findActive();\r\n  }\r\n\r\n  @Get(':id')\r\n  async findOne(@Param('id') id: string) {\r\n    return this.bannerService.findOne(id);\r\n  }\r\n\r\n  @Patch(':id')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles(Role.Admin)\r\n  @UseInterceptors(FilesInterceptor('images', 1)) // Allow only 1 image per banner\r\n  async update(\r\n    @Param('id') id: string,\r\n    @Body() updateBannerDto: UpdateBannerDto,\r\n    @UploadedFiles() images?: Express.Multer.File[],\r\n  ) {\r\n    try {\r\n      let imageUrl = updateBannerDto.imageUrl;\r\n\r\n      if (images && images.length > 0) {\r\n        // Upload image to Cloudinary with banner optimization\r\n        imageUrl = await this.appService.uploadBannerImageToCloudinary(\r\n          images[0],\r\n        );\r\n      }\r\n\r\n      const banner = await this.bannerService.update(id, {\r\n        ...updateBannerDto,\r\n        imageUrl: imageUrl,\r\n      });\r\n\r\n      return banner;\r\n    } catch (error) {\r\n      throw new HttpException(\r\n        error.message || 'Error updating banner',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  @Delete(':id')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles(Role.Admin)\r\n  async remove(@Param('id') id: string) {\r\n    await this.bannerService.remove(id);\r\n    return { message: 'Banner deleted successfully' };\r\n  }\r\n}\r\n"],"names":["BannerController","create","createBannerDto","images","imageUrl","length","appService","uploadBannerImageToCloudinary","banner","bannerService","error","HttpException","message","HttpStatus","INTERNAL_SERVER_ERROR","findAll","findActive","findOne","id","update","updateBannerDto","remove","Admin"],"mappings":";;;;+BAwBaA;;;eAAAA;;;wBAXN;iCAC0B;+BACH;2BACmB;8BACpB;4BACF;gCACL;0BACD;4BACM;;;;;;;;;;;;;;;AAGpB,IAAA,AAAMA,mBAAN,MAAMA;IAMX,MAIMC,OACJ,AAAQC,eAAgC,EACxC,AAAiBC,MAA8B,EAC/C;QACA,IAAI;YACF,IAAIC,WAAW;YAEf,IAAID,UAAUA,OAAOE,MAAM,GAAG,GAAG;gBAC/B,sDAAsD;gBACtDD,WAAW,MAAM,IAAI,CAACE,UAAU,CAACC,6BAA6B,CAC5DJ,MAAM,CAAC,EAAE;YAEb;YAEA,MAAMK,SAAS,MAAM,IAAI,CAACC,aAAa,CAACR,MAAM,CAAC;gBAC7C,GAAGC,eAAe;gBAClBE,UAAUA;YACZ;YAEA,OAAOI;QACT,EAAE,OAAOE,OAAO;YACd,MAAM,IAAIC,qBAAa,CACrBD,MAAME,OAAO,IAAI,yBACjBC,kBAAU,CAACC,qBAAqB;QAEpC;IACF;IAEA,MACMC,UAAU;QACd,OAAO,IAAI,CAACN,aAAa,CAACM,OAAO;IACnC;IAEA,MACMC,aAAa;QACjB,OAAO,IAAI,CAACP,aAAa,CAACO,UAAU;IACtC;IAEA,MACMC,QAAQ,AAAaC,EAAU,EAAE;QACrC,OAAO,IAAI,CAACT,aAAa,CAACQ,OAAO,CAACC;IACpC;IAEA,MAIMC,OACJ,AAAaD,EAAU,EACvB,AAAQE,eAAgC,EACxC,AAAiBjB,MAA8B,EAC/C;QACA,IAAI;YACF,IAAIC,WAAWgB,gBAAgBhB,QAAQ;YAEvC,IAAID,UAAUA,OAAOE,MAAM,GAAG,GAAG;gBAC/B,sDAAsD;gBACtDD,WAAW,MAAM,IAAI,CAACE,UAAU,CAACC,6BAA6B,CAC5DJ,MAAM,CAAC,EAAE;YAEb;YAEA,MAAMK,SAAS,MAAM,IAAI,CAACC,aAAa,CAACU,MAAM,CAACD,IAAI;gBACjD,GAAGE,eAAe;gBAClBhB,UAAUA;YACZ;YAEA,OAAOI;QACT,EAAE,OAAOE,OAAO;YACd,MAAM,IAAIC,qBAAa,CACrBD,MAAME,OAAO,IAAI,yBACjBC,kBAAU,CAACC,qBAAqB;QAEpC;IACF;IAEA,MAGMO,OAAO,AAAaH,EAAU,EAAE;QACpC,MAAM,IAAI,CAACT,aAAa,CAACY,MAAM,CAACH;QAChC,OAAO;YAAEN,SAAS;QAA8B;IAClD;IA3FA,YACE,AAAiBH,aAA4B,EAC7C,AAAiBH,UAAsB,CACvC;aAFiBG,gBAAAA;aACAH,aAAAA;IAChB;AAyFL;;;;8CArFcgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8CA+CAA;;;;;;;;;;;;;;;;8CAiCAA"}