{"version":3,"sources":["../../../src/categories/schemas/category.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\r\nimport { HydratedDocument } from 'mongoose';\r\nimport { ApiProperty } from '@nestjs/swagger';\r\n\r\nexport type CategoryDocument = HydratedDocument<Category>;\r\n\r\n@Schema({ timestamps: true, toJSON: { virtuals: true } })\r\nexport class Category {\r\n  @ApiProperty({\r\n    description: 'Category ID (auto-generated)',\r\n    example: '60d21b4667d0d8992e610c85',\r\n  })\r\n  id: string;\r\n\r\n  @ApiProperty({ description: 'Category name', example: 'ტანსაცმელი' })\r\n  @Prop({\r\n    required: true,\r\n    unique: true,\r\n  })\r\n  name: string;\r\n\r\n  @ApiProperty({ description: 'Category name in English', example: 'Clothing' })\r\n  @Prop()\r\n  nameEn?: string;\r\n\r\n  @ApiProperty({\r\n    description: 'Category description',\r\n    example: 'სხვადასხვა ტიპის ტანსაცმელი',\r\n  })\r\n  @Prop()\r\n  description?: string;\r\n\r\n  @ApiProperty({\r\n    description: 'Category description in English',\r\n    example: 'Various types of clothing',\r\n  })\r\n  @Prop()\r\n  descriptionEn?: string;\r\n\r\n  @ApiProperty({ description: 'Is category active', default: true })\r\n  @Prop({ default: true })\r\n  isActive: boolean;\r\n\r\n  @ApiProperty({\r\n    description: 'Creation date',\r\n    example: '2023-06-20T12:00:00Z',\r\n  })\r\n  createdAt: Date;\r\n\r\n  @ApiProperty({\r\n    description: 'Last update date',\r\n    example: '2023-06-20T12:00:00Z',\r\n  })\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const CategorySchema = SchemaFactory.createForClass(Category);\r\n\r\n// Ensure the virtual id field is properly included in serialization\r\nCategorySchema.set('toJSON', {\r\n  virtuals: true,\r\n  transform: (doc, ret) => {\r\n    ret.id = ret._id;\r\n    delete ret._id;\r\n    delete ret.__v;\r\n    return ret;\r\n  },\r\n});\r\n\r\n// Add a pre-save hook to remove any unexpected fields\r\nCategorySchema.pre('save', function (next) {\r\n  // Ensure only allowed fields are saved\r\n  const allowedFields = [\r\n    'name',\r\n    'nameEn',\r\n    'description',\r\n    'descriptionEn',\r\n    'isActive',\r\n  ];\r\n\r\n  // Get all fields in the document\r\n  const documentFields = Object.keys(this.toObject());\r\n\r\n  // Remove any fields that aren't in allowedFields and aren't MongoDB internal fields\r\n  documentFields.forEach((field) => {\r\n    if (\r\n      !allowedFields.includes(field) &&\r\n      !field.startsWith('_') &&\r\n      field !== 'createdAt' &&\r\n      field !== 'updatedAt'\r\n    ) {\r\n      // @ts-ignore - dynamically remove unexpected fields\r\n      this[field] = undefined;\r\n    }\r\n  });\r\n\r\n  next();\r\n});\r\n"],"names":["Category","CategorySchema","description","example","required","unique","default","timestamps","toJSON","virtuals","SchemaFactory","createForClass","set","transform","doc","ret","id","_id","__v","pre","next","allowedFields","documentFields","Object","keys","toObject","forEach","field","includes","startsWith","undefined"],"mappings":";;;;;;;;;;;QAOaA;eAAAA;;QAiDAC;eAAAA;;;0BAxD+B;yBAEhB;;;;;;;;;;AAKrB,IAAA,AAAMD,WAAN,MAAMA;AA+Cb;;;QA7CIE,aAAa;QACbC,SAAS;;;;;;QAIID,aAAa;QAAiBC,SAAS;;;QAEpDC,UAAU;QACVC,QAAQ;;;;;;QAIKH,aAAa;QAA4BC,SAAS;;;;;;;QAK/DD,aAAa;QACbC,SAAS;;;;;;;QAMTD,aAAa;QACbC,SAAS;;;;;;;QAKID,aAAa;QAAsBI,SAAS;;;QACnDA,SAAS;;;;;;QAIfJ,aAAa;QACbC,SAAS;;;;;;QAKTD,aAAa;QACbC,SAAS;;;;;;QA7CHI,YAAY;QAAMC,QAAQ;YAAEC,UAAU;QAAK;;;AAkD9C,MAAMR,iBAAiBS,uBAAa,CAACC,cAAc,CAACX;AAE3D,oEAAoE;AACpEC,eAAeW,GAAG,CAAC,UAAU;IAC3BH,UAAU;IACVI,WAAW,CAACC,KAAKC;QACfA,IAAIC,EAAE,GAAGD,IAAIE,GAAG;QAChB,OAAOF,IAAIE,GAAG;QACd,OAAOF,IAAIG,GAAG;QACd,OAAOH;IACT;AACF;AAEA,sDAAsD;AACtDd,eAAekB,GAAG,CAAC,QAAQ,SAAUC,IAAI;IACvC,uCAAuC;IACvC,MAAMC,gBAAgB;QACpB;QACA;QACA;QACA;QACA;KACD;IAED,iCAAiC;IACjC,MAAMC,iBAAiBC,OAAOC,IAAI,CAAC,IAAI,CAACC,QAAQ;IAEhD,oFAAoF;IACpFH,eAAeI,OAAO,CAAC,CAACC;QACtB,IACE,CAACN,cAAcO,QAAQ,CAACD,UACxB,CAACA,MAAME,UAAU,CAAC,QAClBF,UAAU,eACVA,UAAU,aACV;YACA,oDAAoD;YACpD,IAAI,CAACA,MAAM,GAAGG;QAChB;IACF;IAEAV;AACF"}