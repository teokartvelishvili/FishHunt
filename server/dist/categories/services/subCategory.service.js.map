{"version":3,"sources":["../../../src/categories/services/subCategory.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  NotFoundException,\r\n  ConflictException,\r\n  BadRequestException,\r\n  InternalServerErrorException, // Added for robust error handling\r\n} from '@nestjs/common';\r\nimport { InjectModel } from '@nestjs/mongoose';\r\nimport { Model, isValidObjectId } from 'mongoose';\r\nimport {\r\n  SubCategory,\r\n  SubCategoryDocument,\r\n} from '../schemas/subcategory.schema';\r\nimport {\r\n  CreateSubCategoryDto,\r\n  UpdateSubCategoryDto,\r\n} from '../dto/subcategory.dto';\r\nimport { Category } from '../schemas/category.schema';\r\nimport { ColorService } from './color.service';\r\nimport { SizeService } from './size.service';\r\nimport { AgeGroupService } from './age-group.service';\r\n\r\n@Injectable()\r\nexport class SubCategoryService {\r\n  constructor(\r\n    @InjectModel(SubCategory.name)\r\n    private subCategoryModel: Model<SubCategoryDocument>,\r\n    @InjectModel(Category.name) private categoryModel: Model<Category>,\r\n    private readonly colorService: ColorService,\r\n    private readonly sizeService: SizeService,\r\n    private readonly ageGroupService: AgeGroupService,\r\n  ) {}\r\n\r\n  async findAll(\r\n    categoryId?: string,\r\n    includeInactive = false,\r\n  ): Promise<SubCategory[]> {\r\n    console.log(\r\n      `[SubCategoryService] findAll called. categoryId: \"${categoryId}\", includeInactive: ${includeInactive}`,\r\n    );\r\n\r\n    const filter: any = includeInactive ? {} : { isActive: true };\r\n\r\n    if (categoryId) {\r\n      console.log(\r\n        `[SubCategoryService] Processing with categoryId: \"${categoryId}\"`,\r\n      );\r\n      if (!isValidObjectId(categoryId)) {\r\n        console.error(\r\n          `[SubCategoryService] Invalid category ID format provided: \"${categoryId}\"`,\r\n        );\r\n        throw new BadRequestException(\r\n          `Invalid category ID format: ${categoryId}`,\r\n        );\r\n      }\r\n\r\n      try {\r\n        const categoryExists = await this.categoryModel\r\n          .findById(categoryId)\r\n          .exec();\r\n        if (!categoryExists) {\r\n          console.warn(\r\n            `[SubCategoryService] Category with ID \"${categoryId}\" not found in database.`,\r\n          );\r\n          throw new NotFoundException(\r\n            `Category with ID ${categoryId} not found`,\r\n          );\r\n        }\r\n        console.log(\r\n          `[SubCategoryService] Category \"${categoryId}\" confirmed to exist.`,\r\n        );\r\n        filter.categoryId = categoryId;\r\n      } catch (error) {\r\n        console.error(\r\n          `[SubCategoryService] Error during category existence check for ID \"${categoryId}\":`,\r\n          error.message,\r\n        );\r\n        if (\r\n          error instanceof NotFoundException ||\r\n          error instanceof BadRequestException\r\n        ) {\r\n          throw error;\r\n        }\r\n        // For other errors, throw a generic server error\r\n        throw new InternalServerErrorException(\r\n          `An error occurred while verifying category ID ${categoryId}`,\r\n        );\r\n      }\r\n    } else {\r\n      console.log(\r\n        '[SubCategoryService] No categoryId provided. Fetching subcategories based on isActive status only.',\r\n      );\r\n    }\r\n\r\n    try {\r\n      console.log(\r\n        '[SubCategoryService] Executing find query with filter:',\r\n        JSON.stringify(filter),\r\n      );\r\n      const subcategories = await this.subCategoryModel\r\n        .find(filter)\r\n        .populate('categoryId', 'name') // Ensure category name is populated\r\n        .sort({ name: 1 })\r\n        .exec();\r\n\r\n      console.log(\r\n        `[SubCategoryService] Database query returned ${subcategories.length} subcategories.`,\r\n      );\r\n      if (subcategories.length > 0) {\r\n        console.log(\r\n          '[SubCategoryService] Example of first subcategory found:',\r\n          JSON.stringify(subcategories[0]),\r\n        );\r\n      } else if (categoryId) {\r\n        console.log(\r\n          `[SubCategoryService] No subcategories found for categoryId: \"${categoryId}\" with current filters.`,\r\n        );\r\n      }\r\n      return subcategories;\r\n    } catch (error) {\r\n      console.error(\r\n        `[SubCategoryService] Database error while finding subcategories:`,\r\n        error.message,\r\n        error.stack,\r\n      );\r\n      throw new InternalServerErrorException(\r\n        'A database error occurred while retrieving subcategories',\r\n      );\r\n    }\r\n  }\r\n\r\n  async findById(id: string): Promise<SubCategory> {\r\n    if (!isValidObjectId(id)) {\r\n      throw new BadRequestException(`Invalid subcategory ID format: ${id}`);\r\n    }\r\n\r\n    const subcategory = await this.subCategoryModel\r\n      .findById(id)\r\n      .populate('categoryId', 'name')\r\n      .exec();\r\n\r\n    if (!subcategory) {\r\n      throw new NotFoundException(`Subcategory with ID ${id} not found`);\r\n    }\r\n\r\n    return subcategory;\r\n  }\r\n\r\n  async create(\r\n    createSubCategoryDto: CreateSubCategoryDto,\r\n  ): Promise<SubCategory> {\r\n    // Check if category exists\r\n    const categoryExists = await this.categoryModel\r\n      .findById(createSubCategoryDto.categoryId)\r\n      .exec();\r\n\r\n    if (!categoryExists) {\r\n      throw new NotFoundException(\r\n        `Category with ID ${createSubCategoryDto.categoryId} not found`,\r\n      );\r\n    }\r\n\r\n    // Check if subcategory with same name exists under the same category\r\n    const existingSubCategory = await this.subCategoryModel\r\n      .findOne({\r\n        name: createSubCategoryDto.name,\r\n        categoryId: createSubCategoryDto.categoryId,\r\n      })\r\n      .exec();\r\n\r\n    if (existingSubCategory) {\r\n      throw new ConflictException(\r\n        `Subcategory with name \"${createSubCategoryDto.name}\" already exists in this category`,\r\n      );\r\n    }\r\n\r\n    const newSubCategory = new this.subCategoryModel(createSubCategoryDto);\r\n    return newSubCategory.save();\r\n  }\r\n\r\n  async update(\r\n    id: string,\r\n    updateSubCategoryDto: UpdateSubCategoryDto,\r\n  ): Promise<SubCategory> {\r\n    if (!isValidObjectId(id)) {\r\n      throw new BadRequestException(`Invalid subcategory ID format: ${id}`);\r\n    }\r\n\r\n    // If updating the category, check if it exists\r\n    if (updateSubCategoryDto.categoryId) {\r\n      const categoryExists = await this.categoryModel\r\n        .findById(updateSubCategoryDto.categoryId)\r\n        .exec();\r\n\r\n      if (!categoryExists) {\r\n        throw new NotFoundException(\r\n          `Category with ID ${updateSubCategoryDto.categoryId} not found`,\r\n        );\r\n      }\r\n    }\r\n\r\n    // If updating name, check for duplicates\r\n    if (updateSubCategoryDto.name) {\r\n      const existingSubCategory = await this.subCategoryModel\r\n        .findOne({\r\n          name: updateSubCategoryDto.name,\r\n          categoryId: updateSubCategoryDto.categoryId || { $exists: true },\r\n          _id: { $ne: id },\r\n        })\r\n        .exec();\r\n\r\n      if (existingSubCategory) {\r\n        throw new ConflictException(\r\n          `Subcategory with name \"${updateSubCategoryDto.name}\" already exists in this category`,\r\n        );\r\n      }\r\n    }\r\n\r\n    const updatedSubCategory = await this.subCategoryModel\r\n      .findByIdAndUpdate(id, updateSubCategoryDto, { new: true })\r\n      .populate('categoryId', 'name')\r\n      .exec();\r\n\r\n    if (!updatedSubCategory) {\r\n      throw new NotFoundException(`Subcategory with ID ${id} not found`);\r\n    }\r\n\r\n    return updatedSubCategory;\r\n  }\r\n\r\n  async remove(id: string): Promise<void> {\r\n    if (!isValidObjectId(id)) {\r\n      throw new BadRequestException(`Invalid subcategory ID format: ${id}`);\r\n    }\r\n\r\n    const result = await this.subCategoryModel.findByIdAndDelete(id).exec();\r\n    if (!result) {\r\n      throw new NotFoundException(`Subcategory with ID ${id} not found`);\r\n    }\r\n  }\r\n\r\n  // Get all attribute options available for categories\r\n  async getAttributeOptions() {\r\n    const colors = await this.getAllColors();\r\n    const sizes = await this.getAllSizes();\r\n    const ageGroups = await this.getAllAgeGroups();\r\n\r\n    return {\r\n      colors,\r\n      sizes,\r\n      ageGroups,\r\n    };\r\n  }\r\n\r\n  // Global attribute management methods\r\n  async getAllColors(): Promise<string[]> {\r\n    try {\r\n      console.log('Getting all colors from service');\r\n      const colors = await this.colorService.findAll(false);\r\n      console.log(`Found ${colors.length} colors`);\r\n      return colors.map((color) => color.name);\r\n    } catch (error) {\r\n      console.error('Error getting all colors:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async getAllSizes(): Promise<string[]> {\r\n    try {\r\n      console.log('Getting all sizes from service');\r\n      const sizes = await this.sizeService.findAll(false);\r\n      console.log(`Found ${sizes.length} sizes`);\r\n      return sizes.map((size) => size.value);\r\n    } catch (error) {\r\n      console.error('Error getting all sizes:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async getAllAgeGroups(): Promise<string[]> {\r\n    try {\r\n      console.log('Getting all age groups from service');\r\n      const ageGroups = await this.ageGroupService.findAll(false);\r\n      console.log(`Found ${ageGroups.length} age groups`);\r\n      return ageGroups.map((ageGroup) => ageGroup.name);\r\n    } catch (error) {\r\n      console.error('Error getting all age groups:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Color management\r\n  async createColor(colorName: string): Promise<any> {\r\n    return this.colorService.create({ name: colorName });\r\n  }\r\n\r\n  async updateColor(oldName: string, newName: string): Promise<any> {\r\n    const color = await this.colorService\r\n      .findAll()\r\n      .then((colors) => colors.find((c) => c.name === oldName));\r\n\r\n    if (!color) {\r\n      throw new NotFoundException(`Color \"${oldName}\" not found`);\r\n    }\r\n\r\n    return this.colorService.update(color._id.toString(), { name: newName });\r\n  }\r\n\r\n  async deleteColor(colorName: string): Promise<any> {\r\n    const color = await this.colorService\r\n      .findAll()\r\n      .then((colors) => colors.find((c) => c.name === colorName));\r\n\r\n    if (!color) {\r\n      throw new NotFoundException(`Color \"${colorName}\" not found`);\r\n    }\r\n\r\n    return this.colorService.remove(color._id.toString());\r\n  }\r\n\r\n  // Size management\r\n  async createSize(sizeValue: string): Promise<any> {\r\n    return this.sizeService.create({ value: sizeValue });\r\n  }\r\n\r\n  async updateSize(oldValue: string, newValue: string): Promise<any> {\r\n    const size = await this.sizeService\r\n      .findAll()\r\n      .then((sizes) => sizes.find((s) => s.value === oldValue));\r\n\r\n    if (!size) {\r\n      throw new NotFoundException(`Size \"${oldValue}\" not found`);\r\n    }\r\n\r\n    return this.sizeService.update(size._id.toString(), { value: newValue });\r\n  }\r\n\r\n  async deleteSize(sizeValue: string): Promise<any> {\r\n    const size = await this.sizeService\r\n      .findAll()\r\n      .then((sizes) => sizes.find((s) => s.value === sizeValue));\r\n\r\n    if (!size) {\r\n      throw new NotFoundException(`Size \"${sizeValue}\" not found`);\r\n    }\r\n\r\n    return this.sizeService.remove(size._id.toString());\r\n  }\r\n\r\n  // Age group management\r\n  async createAgeGroup(ageGroupName: string): Promise<any> {\r\n    return this.ageGroupService.create({ name: ageGroupName });\r\n  }\r\n\r\n  async updateAgeGroup(oldName: string, newName: string): Promise<any> {\r\n    const ageGroup = await this.ageGroupService\r\n      .findAll()\r\n      .then((ageGroups) => ageGroups.find((a) => a.name === oldName));\r\n\r\n    if (!ageGroup) {\r\n      throw new NotFoundException(`Age group \"${oldName}\" not found`);\r\n    }\r\n\r\n    return this.ageGroupService.update(ageGroup._id.toString(), {\r\n      name: newName,\r\n    });\r\n  }\r\n\r\n  async deleteAgeGroup(ageGroupName: string): Promise<any> {\r\n    const ageGroup = await this.ageGroupService\r\n      .findAll()\r\n      .then((ageGroups) => ageGroups.find((a) => a.name === ageGroupName));\r\n\r\n    if (!ageGroup) {\r\n      throw new NotFoundException(`Age group \"${ageGroupName}\" not found`);\r\n    }\r\n\r\n    return this.ageGroupService.remove(ageGroup._id.toString());\r\n  }\r\n}\r\n"],"names":["SubCategoryService","findAll","categoryId","includeInactive","console","log","filter","isActive","isValidObjectId","error","BadRequestException","categoryExists","categoryModel","findById","exec","warn","NotFoundException","message","InternalServerErrorException","JSON","stringify","subcategories","subCategoryModel","find","populate","sort","name","length","stack","id","subcategory","create","createSubCategoryDto","existingSubCategory","findOne","ConflictException","newSubCategory","save","update","updateSubCategoryDto","$exists","_id","$ne","updatedSubCategory","findByIdAndUpdate","new","remove","result","findByIdAndDelete","getAttributeOptions","colors","getAllColors","sizes","getAllSizes","ageGroups","getAllAgeGroups","colorService","map","color","sizeService","size","value","ageGroupService","ageGroup","createColor","colorName","updateColor","oldName","newName","then","c","toString","deleteColor","createSize","sizeValue","updateSize","oldValue","newValue","s","deleteSize","createAgeGroup","ageGroupName","updateAgeGroup","a","deleteAgeGroup"],"mappings":"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"}