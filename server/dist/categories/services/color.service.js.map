{"version":3,"sources":["../../../src/categories/services/color.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  NotFoundException,\r\n  ConflictException,\r\n} from '@nestjs/common';\r\nimport { InjectModel } from '@nestjs/mongoose';\r\nimport { Model } from 'mongoose';\r\nimport { Color, ColorDocument } from '../schemas/color.schema';\r\nimport { CreateColorDto, UpdateColorDto } from '../dto/color.dto';\r\n\r\n@Injectable()\r\nexport class ColorService {\r\n  constructor(\r\n    @InjectModel(Color.name) private colorModel: Model<ColorDocument>,\r\n  ) {}\r\n\r\n  async findAll(includeInactive = false): Promise<Color[]> {\r\n    try {\r\n      const filter = includeInactive ? {} : { isActive: true };\r\n      const colors = await this.colorModel\r\n        .find(filter)\r\n        .sort({ name: 1 })\r\n        .exec();\r\n      console.log(`Color service found ${colors.length} colors`);\r\n      return colors;\r\n    } catch (error) {\r\n      console.error('Error finding colors:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async findById(id: string): Promise<Color> {\r\n    const color = await this.colorModel.findById(id).exec();\r\n    if (!color) {\r\n      throw new NotFoundException(`Color with ID ${id} not found`);\r\n    }\r\n    return color;\r\n  }\r\n\r\n  async create(createColorDto: CreateColorDto): Promise<Color> {\r\n    const existingColor = await this.colorModel\r\n      .findOne({ name: createColorDto.name })\r\n      .exec();\r\n    if (existingColor) {\r\n      throw new ConflictException(\r\n        `Color with name ${createColorDto.name} already exists`,\r\n      );\r\n    }\r\n\r\n    const newColor = new this.colorModel(createColorDto);\r\n    return newColor.save();\r\n  }\r\n  async update(id: string, updateColorDto: UpdateColorDto): Promise<Color> {\r\n    // Validate that id is a valid MongoDB ObjectId\r\n    if (!id || !id.match(/^[0-9a-fA-F]{24}$/)) {\r\n      throw new NotFoundException(`Invalid color ID format: ${id}`);\r\n    }\r\n\r\n    if (updateColorDto.name) {\r\n      const existingColor = await this.colorModel\r\n        .findOne({\r\n          name: updateColorDto.name,\r\n          _id: { $ne: id },\r\n        })\r\n        .exec();\r\n\r\n      if (existingColor) {\r\n        throw new ConflictException(\r\n          `Color with name ${updateColorDto.name} already exists`,\r\n        );\r\n      }\r\n    }\r\n\r\n    const updatedColor = await this.colorModel\r\n      .findByIdAndUpdate(id, updateColorDto, { new: true })\r\n      .exec();\r\n\r\n    if (!updatedColor) {\r\n      throw new NotFoundException(`Color with ID ${id} not found`);\r\n    }\r\n\r\n    return updatedColor;\r\n  }\r\n  async remove(id: string): Promise<void> {\r\n    // Validate that id is a valid MongoDB ObjectId\r\n    if (!id || !id.match(/^[0-9a-fA-F]{24}$/)) {\r\n      throw new NotFoundException(`Invalid color ID format: ${id}`);\r\n    }\r\n\r\n    const result = await this.colorModel.findByIdAndDelete(id).exec();\r\n    if (!result) {\r\n      throw new NotFoundException(`Color with ID ${id} not found`);\r\n    }\r\n  }\r\n}\r\n"],"names":["ColorService","findAll","includeInactive","filter","isActive","colors","colorModel","find","sort","name","exec","console","log","length","error","findById","id","color","NotFoundException","create","createColorDto","existingColor","findOne","ConflictException","newColor","save","update","updateColorDto","match","_id","$ne","updatedColor","findByIdAndUpdate","new","remove","result","findByIdAndDelete"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAPN;0BACqB;2BACN;6BACe;;;;;;;;;;;;;;;AAI9B,IAAA,AAAMA,eAAN,MAAMA;IAKX,MAAMC,QAAQC,kBAAkB,KAAK,EAAoB;QACvD,IAAI;YACF,MAAMC,SAASD,kBAAkB,CAAC,IAAI;gBAAEE,UAAU;YAAK;YACvD,MAAMC,SAAS,MAAM,IAAI,CAACC,UAAU,CACjCC,IAAI,CAACJ,QACLK,IAAI,CAAC;gBAAEC,MAAM;YAAE,GACfC,IAAI;YACPC,QAAQC,GAAG,CAAC,CAAC,oBAAoB,EAAEP,OAAOQ,MAAM,CAAC,OAAO,CAAC;YACzD,OAAOR;QACT,EAAE,OAAOS,OAAO;YACdH,QAAQG,KAAK,CAAC,yBAAyBA;YACvC,OAAO,EAAE;QACX;IACF;IAEA,MAAMC,SAASC,EAAU,EAAkB;QACzC,MAAMC,QAAQ,MAAM,IAAI,CAACX,UAAU,CAACS,QAAQ,CAACC,IAAIN,IAAI;QACrD,IAAI,CAACO,OAAO;YACV,MAAM,IAAIC,yBAAiB,CAAC,CAAC,cAAc,EAAEF,GAAG,UAAU,CAAC;QAC7D;QACA,OAAOC;IACT;IAEA,MAAME,OAAOC,cAA8B,EAAkB;QAC3D,MAAMC,gBAAgB,MAAM,IAAI,CAACf,UAAU,CACxCgB,OAAO,CAAC;YAAEb,MAAMW,eAAeX,IAAI;QAAC,GACpCC,IAAI;QACP,IAAIW,eAAe;YACjB,MAAM,IAAIE,yBAAiB,CACzB,CAAC,gBAAgB,EAAEH,eAAeX,IAAI,CAAC,eAAe,CAAC;QAE3D;QAEA,MAAMe,WAAW,IAAI,IAAI,CAAClB,UAAU,CAACc;QACrC,OAAOI,SAASC,IAAI;IACtB;IACA,MAAMC,OAAOV,EAAU,EAAEW,cAA8B,EAAkB;QACvE,+CAA+C;QAC/C,IAAI,CAACX,MAAM,CAACA,GAAGY,KAAK,CAAC,sBAAsB;YACzC,MAAM,IAAIV,yBAAiB,CAAC,CAAC,yBAAyB,EAAEF,IAAI;QAC9D;QAEA,IAAIW,eAAelB,IAAI,EAAE;YACvB,MAAMY,gBAAgB,MAAM,IAAI,CAACf,UAAU,CACxCgB,OAAO,CAAC;gBACPb,MAAMkB,eAAelB,IAAI;gBACzBoB,KAAK;oBAAEC,KAAKd;gBAAG;YACjB,GACCN,IAAI;YAEP,IAAIW,eAAe;gBACjB,MAAM,IAAIE,yBAAiB,CACzB,CAAC,gBAAgB,EAAEI,eAAelB,IAAI,CAAC,eAAe,CAAC;YAE3D;QACF;QAEA,MAAMsB,eAAe,MAAM,IAAI,CAACzB,UAAU,CACvC0B,iBAAiB,CAAChB,IAAIW,gBAAgB;YAAEM,KAAK;QAAK,GAClDvB,IAAI;QAEP,IAAI,CAACqB,cAAc;YACjB,MAAM,IAAIb,yBAAiB,CAAC,CAAC,cAAc,EAAEF,GAAG,UAAU,CAAC;QAC7D;QAEA,OAAOe;IACT;IACA,MAAMG,OAAOlB,EAAU,EAAiB;QACtC,+CAA+C;QAC/C,IAAI,CAACA,MAAM,CAACA,GAAGY,KAAK,CAAC,sBAAsB;YACzC,MAAM,IAAIV,yBAAiB,CAAC,CAAC,yBAAyB,EAAEF,IAAI;QAC9D;QAEA,MAAMmB,SAAS,MAAM,IAAI,CAAC7B,UAAU,CAAC8B,iBAAiB,CAACpB,IAAIN,IAAI;QAC/D,IAAI,CAACyB,QAAQ;YACX,MAAM,IAAIjB,yBAAiB,CAAC,CAAC,cAAc,EAAEF,GAAG,UAAU,CAAC;QAC7D;IACF;IAjFA,YACE,AAAiCV,UAAgC,CACjE;aADiCA,aAAAA;IAChC;AAgFL;;;+DAjFuBG"}