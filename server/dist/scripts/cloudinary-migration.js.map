{"version":3,"sources":["../../src/scripts/cloudinary-migration.ts"],"sourcesContent":["/**\r\n * Cloudinary Migration Script\r\n *\r\n * ·É´·Éï·Éî·Éö·Éò Cloudinary (dsufx8uzd) -> ·Éê·ÉÆ·Éê·Éö·Éò Cloudinary (dqbre9j3o) ·Éõ·Éò·Éí·É†·Éê·É™·Éò·Éê\r\n *\r\n * ·Éí·Éê·É®·Éï·Éî·Éë·Éê: npx ts-node src/scripts/cloudinary-migration.ts\r\n */\r\n\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { MongoClient } from 'mongodb';\r\nimport * as dotenv from 'dotenv';\r\n\r\ndotenv.config();\r\n\r\n// ·É´·Éï·Éî·Éö·Éò Cloudinary ·Éô·Éù·Éú·É§·Éò·Éí·É£·É†·Éê·É™·Éò·Éê\r\nconst OLD_CLOUDINARY = {\r\n  cloud_name: 'dsufx8uzd',\r\n  api_key: '526676916676116',\r\n  api_secret: 'oG_mVmeJJ6kT6QleyottU2YPL9Q',\r\n};\r\n\r\n// ·Éê·ÉÆ·Éê·Éö·Éò Cloudinary ·Éô·Éù·Éú·É§·Éò·Éí·É£·É†·Éê·É™·Éò·Éê\r\nconst NEW_CLOUDINARY = {\r\n  cloud_name: 'dqbre9j3o',\r\n  api_key: '933351519728752',\r\n  api_secret: 'FOXqjJV3S4bxlP6ul4QucpP5xf8',\r\n};\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || '';\r\n\r\ninterface MigrationResult {\r\n  oldUrl: string;\r\n  newUrl: string;\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\n// URL-·Éò·É° ·É®·Éî·É™·Éï·Éö·Éò·É° ·É§·É£·Éú·É•·É™·Éò·Éê\r\nfunction replaceCloudinaryUrl(url: string, newCloudName: string): string {\r\n  if (!url || typeof url !== 'string') return url;\r\n\r\n  // ·É®·Éî·Éê·Éõ·Éù·É¨·Éõ·Éî ·Éó·É£ ·Éî·É° ·É´·Éï·Éî·Éö·Éò cloudinary URL ·Éê·É†·Éò·É°\r\n  if (url.includes('dsufx8uzd')) {\r\n    return url.replace('dsufx8uzd', newCloudName);\r\n  }\r\n  return url;\r\n}\r\n\r\n// ·É°·É£·É†·Éê·Éó·Éò·É° ·Éí·Éê·Éì·Éê·É¢·Éê·Éú·Éê ·Éê·ÉÆ·Éê·Éö Cloudinary-·Éñ·Éî\r\nasync function migrateImage(oldUrl: string): Promise<MigrationResult> {\r\n  if (!oldUrl || !oldUrl.includes('dsufx8uzd')) {\r\n    return { oldUrl, newUrl: oldUrl, success: true };\r\n  }\r\n\r\n  try {\r\n    // ·Éô·Éù·Éú·É§·Éò·Éí·É£·É†·Éê·É™·Éò·Éê ·Éê·ÉÆ·Éê·Éö·Éò Cloudinary-·É°·Éó·Éï·Éò·É°\r\n    cloudinary.config(NEW_CLOUDINARY);\r\n\r\n    // ·É´·Éï·Éî·Éö·Éò URL-·Éì·Éê·Éú ·Éê·É¢·Éï·Éò·É†·Éó·Éï·Éê ·Éê·ÉÆ·Éê·Éö Cloudinary-·Éñ·Éî\r\n    const result = await cloudinary.uploader.upload(oldUrl, {\r\n      folder: 'migrated',\r\n    });\r\n\r\n    console.log(`‚úÖ Migrated: ${oldUrl} -> ${result.secure_url}`);\r\n    return {\r\n      oldUrl,\r\n      newUrl: result.secure_url,\r\n      success: true,\r\n    };\r\n  } catch (error: any) {\r\n    console.error(`‚ùå Failed to migrate: ${oldUrl}`, error.message);\r\n    return {\r\n      oldUrl,\r\n      newUrl: oldUrl,\r\n      success: false,\r\n      error: error.message,\r\n    };\r\n  }\r\n}\r\n\r\n// ·Éõ·Éó·Éê·Éï·Éê·É†·Éò ·Éõ·Éò·Éí·É†·Éê·É™·Éò·Éò·É° ·É§·É£·Éú·É•·É™·Éò·Éê\r\nasync function runMigration() {\r\n  console.log('üöÄ Starting Cloudinary Migration...\\n');\r\n  console.log(`üì¶ Old Cloudinary: ${OLD_CLOUDINARY.cloud_name}`);\r\n  console.log(`üì¶ New Cloudinary: ${NEW_CLOUDINARY.cloud_name}\\n`);\r\n\r\n  const client = new MongoClient(MONGODB_URI);\r\n\r\n  try {\r\n    await client.connect();\r\n    console.log('‚úÖ Connected to MongoDB\\n');\r\n\r\n    const db = client.db();\r\n\r\n    // 1. Products ·Éô·Éù·Éö·Éî·É•·É™·Éò·Éò·É° ·Éõ·Éò·Éí·É†·Éê·É™·Éò·Éê\r\n    console.log('üì∏ Migrating Products...');\r\n    const products = await db.collection('products').find({}).toArray();\r\n    let productsUpdated = 0;\r\n\r\n    for (const product of products) {\r\n      let needsUpdate = false;\r\n      const newImages: string[] = [];\r\n\r\n      // images ·Éõ·Éê·É°·Éò·Éï·Éò·É° ·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·Éê\r\n      if (product.images && Array.isArray(product.images)) {\r\n        for (const image of product.images) {\r\n          if (image && image.includes('dsufx8uzd')) {\r\n            const migrated = await migrateImage(image);\r\n            newImages.push(migrated.newUrl);\r\n            needsUpdate = true;\r\n          } else {\r\n            newImages.push(image);\r\n          }\r\n        }\r\n      }\r\n\r\n      // brandLogo-·É° ·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·Éê\r\n      let newBrandLogo = product.brandLogo;\r\n      if (product.brandLogo && product.brandLogo.includes('dsufx8uzd')) {\r\n        const migrated = await migrateImage(product.brandLogo);\r\n        newBrandLogo = migrated.newUrl;\r\n        needsUpdate = true;\r\n      }\r\n\r\n      if (needsUpdate) {\r\n        await db.collection('products').updateOne(\r\n          { _id: product._id },\r\n          {\r\n            $set: {\r\n              images: newImages,\r\n              brandLogo: newBrandLogo,\r\n            },\r\n          },\r\n        );\r\n        productsUpdated++;\r\n      }\r\n    }\r\n    console.log(`‚úÖ Products updated: ${productsUpdated}\\n`);\r\n\r\n    // 2. Banners ·Éô·Éù·Éö·Éî·É•·É™·Éò·Éò·É° ·Éõ·Éò·Éí·É†·Éê·É™·Éò·Éê\r\n    console.log('üñºÔ∏è Migrating Banners...');\r\n    const banners = await db.collection('banners').find({}).toArray();\r\n    let bannersUpdated = 0;\r\n\r\n    for (const banner of banners) {\r\n      if (banner.imageUrl && banner.imageUrl.includes('dsufx8uzd')) {\r\n        const migrated = await migrateImage(banner.imageUrl);\r\n        await db\r\n          .collection('banners')\r\n          .updateOne(\r\n            { _id: banner._id },\r\n            { $set: { imageUrl: migrated.newUrl } },\r\n          );\r\n        bannersUpdated++;\r\n      }\r\n    }\r\n    console.log(`‚úÖ Banners updated: ${bannersUpdated}\\n`);\r\n\r\n    // 3. Users ·Éô·Éù·Éö·Éî·É•·É™·Éò·Éò·É° ·Éõ·Éò·Éí·É†·Éê·É™·Éò·Éê\r\n    console.log('üë§ Migrating Users...');\r\n    const users = await db.collection('users').find({}).toArray();\r\n    let usersUpdated = 0;\r\n\r\n    for (const user of users) {\r\n      let needsUpdate = false;\r\n      const updates: Record<string, string> = {};\r\n\r\n      if (user.storeLogo && user.storeLogo.includes('dsufx8uzd')) {\r\n        const migrated = await migrateImage(user.storeLogo);\r\n        updates.storeLogo = migrated.newUrl;\r\n        needsUpdate = true;\r\n      }\r\n\r\n      if (\r\n        user.profileImagePath &&\r\n        user.profileImagePath.includes('dsufx8uzd')\r\n      ) {\r\n        const migrated = await migrateImage(user.profileImagePath);\r\n        updates.profileImagePath = migrated.newUrl;\r\n        needsUpdate = true;\r\n      }\r\n\r\n      if (needsUpdate) {\r\n        await db\r\n          .collection('users')\r\n          .updateOne({ _id: user._id }, { $set: updates });\r\n        usersUpdated++;\r\n      }\r\n    }\r\n    console.log(`‚úÖ Users updated: ${usersUpdated}\\n`);\r\n\r\n    // 4. Orders ·Éô·Éù·Éö·Éî·É•·É™·Éò·Éê·É®·Éò ·Éó·É£ ·Éê·É†·Éò·É° ·É°·É£·É†·Éê·Éó·Éî·Éë·Éò\r\n    console.log('üì¶ Checking Orders...');\r\n    const orders = await db.collection('orders').find({}).toArray();\r\n    let ordersUpdated = 0;\r\n\r\n    for (const order of orders) {\r\n      let needsUpdate = false;\r\n      const newOrderItems = [];\r\n\r\n      if (order.orderItems && Array.isArray(order.orderItems)) {\r\n        for (const item of order.orderItems) {\r\n          const newItem = { ...item };\r\n          if (item.image && item.image.includes('dsufx8uzd')) {\r\n            newItem.image = replaceCloudinaryUrl(\r\n              item.image,\r\n              NEW_CLOUDINARY.cloud_name,\r\n            );\r\n            needsUpdate = true;\r\n          }\r\n          newOrderItems.push(newItem);\r\n        }\r\n      }\r\n\r\n      if (needsUpdate) {\r\n        await db\r\n          .collection('orders')\r\n          .updateOne(\r\n            { _id: order._id },\r\n            { $set: { orderItems: newOrderItems } },\r\n          );\r\n        ordersUpdated++;\r\n      }\r\n    }\r\n    console.log(`‚úÖ Orders updated: ${ordersUpdated}\\n`);\r\n\r\n    // 5. Cart ·Éô·Éù·Éö·Éî·É•·É™·Éò·Éê·É®·Éò ·Éó·É£ ·Éê·É†·Éò·É° ·É°·É£·É†·Éê·Éó·Éî·Éë·Éò\r\n    console.log('üõí Checking Carts...');\r\n    const carts = await db.collection('carts').find({}).toArray();\r\n    let cartsUpdated = 0;\r\n\r\n    for (const cart of carts) {\r\n      let needsUpdate = false;\r\n      const newItems = [];\r\n\r\n      if (cart.items && Array.isArray(cart.items)) {\r\n        for (const item of cart.items) {\r\n          const newItem = { ...item };\r\n          if (item.image && item.image.includes('dsufx8uzd')) {\r\n            newItem.image = replaceCloudinaryUrl(\r\n              item.image,\r\n              NEW_CLOUDINARY.cloud_name,\r\n            );\r\n            needsUpdate = true;\r\n          }\r\n          newItems.push(newItem);\r\n        }\r\n      }\r\n\r\n      if (needsUpdate) {\r\n        await db\r\n          .collection('carts')\r\n          .updateOne({ _id: cart._id }, { $set: { items: newItems } });\r\n        cartsUpdated++;\r\n      }\r\n    }\r\n    console.log(`‚úÖ Carts updated: ${cartsUpdated}\\n`);\r\n\r\n    console.log('üéâ Migration completed successfully!');\r\n    console.log('\\nüìä Summary:');\r\n    console.log(`   Products: ${productsUpdated}`);\r\n    console.log(`   Banners: ${bannersUpdated}`);\r\n    console.log(`   Users: ${usersUpdated}`);\r\n    console.log(`   Orders: ${ordersUpdated}`);\r\n    console.log(`   Carts: ${cartsUpdated}`);\r\n  } catch (error) {\r\n    console.error('‚ùå Migration failed:', error);\r\n    throw error;\r\n  } finally {\r\n    await client.close();\r\n    console.log('\\n‚úÖ MongoDB connection closed');\r\n  }\r\n}\r\n\r\n// ·Éê·Éö·É¢·Éî·É†·Éú·Éê·É¢·Éò·É£·Éö·Éò: ·Éõ·Éê·É†·É¢·Éò·Éï·Éò URL replacement (·É°·É£·É†·Éê·Éó·Éî·Éë·Éò·É° ·Éí·Éê·Éì·Éê·É¢·Éê·Éú·Éò·É° ·Éí·Éê·É†·Éî·É®·Éî)\r\nasync function runSimpleUrlReplacement() {\r\n  console.log('üöÄ Starting Simple URL Replacement...\\n');\r\n  console.log(\r\n    '‚ö†Ô∏è This will only replace URLs in database without re-uploading images\\n',\r\n  );\r\n\r\n  const client = new MongoClient(MONGODB_URI);\r\n\r\n  try {\r\n    await client.connect();\r\n    console.log('‚úÖ Connected to MongoDB\\n');\r\n\r\n    const db = client.db();\r\n\r\n    // Products\r\n    const productsResult = await db\r\n      .collection('products')\r\n      .updateMany({ images: { $regex: 'dsufx8uzd' } }, [\r\n        {\r\n          $set: {\r\n            images: {\r\n              $map: {\r\n                input: '$images',\r\n                as: 'img',\r\n                in: {\r\n                  $replaceAll: {\r\n                    input: '$$img',\r\n                    find: 'dsufx8uzd',\r\n                    replacement: 'dqbre9j3o',\r\n                  },\r\n                },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      ]);\r\n    console.log(`Products updated: ${productsResult.modifiedCount}`);\r\n\r\n    // Banners\r\n    const bannersResult = await db\r\n      .collection('banners')\r\n      .updateMany({ imageUrl: { $regex: 'dsufx8uzd' } }, [\r\n        {\r\n          $set: {\r\n            imageUrl: {\r\n              $replaceAll: {\r\n                input: '$imageUrl',\r\n                find: 'dsufx8uzd',\r\n                replacement: 'dqbre9j3o',\r\n              },\r\n            },\r\n          },\r\n        },\r\n      ]);\r\n    console.log(`Banners updated: ${bannersResult.modifiedCount}`);\r\n\r\n    // Users storeLogo\r\n    const usersLogoResult = await db\r\n      .collection('users')\r\n      .updateMany({ storeLogo: { $regex: 'dsufx8uzd' } }, [\r\n        {\r\n          $set: {\r\n            storeLogo: {\r\n              $replaceAll: {\r\n                input: '$storeLogo',\r\n                find: 'dsufx8uzd',\r\n                replacement: 'dqbre9j3o',\r\n              },\r\n            },\r\n          },\r\n        },\r\n      ]);\r\n    console.log(`Users (storeLogo) updated: ${usersLogoResult.modifiedCount}`);\r\n\r\n    // Users profileImagePath\r\n    const usersProfileResult = await db\r\n      .collection('users')\r\n      .updateMany({ profileImagePath: { $regex: 'dsufx8uzd' } }, [\r\n        {\r\n          $set: {\r\n            profileImagePath: {\r\n              $replaceAll: {\r\n                input: '$profileImagePath',\r\n                find: 'dsufx8uzd',\r\n                replacement: 'dqbre9j3o',\r\n              },\r\n            },\r\n          },\r\n        },\r\n      ]);\r\n    console.log(\r\n      `Users (profileImagePath) updated: ${usersProfileResult.modifiedCount}`,\r\n    );\r\n\r\n    console.log('\\nüéâ Simple URL replacement completed!');\r\n  } catch (error) {\r\n    console.error('‚ùå Replacement failed:', error);\r\n    throw error;\r\n  } finally {\r\n    await client.close();\r\n  }\r\n}\r\n\r\n// ·Éê·É†·Éí·É£·Éõ·Éî·Éú·É¢·Éò·É° ·Éõ·Éò·ÉÆ·Éî·Éì·Éï·Éò·Éó ·Éí·Éê·É®·Éï·Éî·Éë·Éê\r\nconst args = process.argv.slice(2);\r\n\r\nif (args.includes('--simple')) {\r\n  runSimpleUrlReplacement();\r\n} else {\r\n  runMigration();\r\n}\r\n"],"names":["dotenv","config","OLD_CLOUDINARY","cloud_name","api_key","api_secret","NEW_CLOUDINARY","MONGODB_URI","process","env","replaceCloudinaryUrl","url","newCloudName","includes","replace","migrateImage","oldUrl","newUrl","success","cloudinary","result","uploader","upload","folder","console","log","secure_url","error","message","runMigration","client","MongoClient","connect","db","products","collection","find","toArray","productsUpdated","product","needsUpdate","newImages","images","Array","isArray","image","migrated","push","newBrandLogo","brandLogo","updateOne","_id","$set","banners","bannersUpdated","banner","imageUrl","users","usersUpdated","user","updates","storeLogo","profileImagePath","orders","ordersUpdated","order","newOrderItems","orderItems","item","newItem","carts","cartsUpdated","cart","newItems","items","close","runSimpleUrlReplacement","productsResult","updateMany","$regex","$map","input","as","in","$replaceAll","replacement","modifiedCount","bannersResult","usersLogoResult","usersProfileResult","args","argv","slice"],"mappings":"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"}