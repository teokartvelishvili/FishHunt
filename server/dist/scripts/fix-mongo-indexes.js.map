{"version":3,"sources":["../../src/scripts/fix-mongo-indexes.js"],"sourcesContent":["// Direct MongoDB script (no TypeScript/mongoose dependencies)\r\n\r\nconst { MongoClient } = require('mongodb');\r\nrequire('dotenv').config();\r\n\r\nasync function fixMongoIndexes() {\r\n  // Get MongoDB connection string from env or use default\r\n  const mongoUri = process.env.MONGODB_URI || 'mongodb://localhost:27017/test';\r\n  console.log(`Connecting to MongoDB at ${mongoUri}`);\r\n\r\n  const client = new MongoClient(mongoUri);\r\n\r\n  try {\r\n    // Connect to MongoDB\r\n    await client.connect();\r\n    console.log('Connected to MongoDB');\r\n\r\n    // Get database name from connection string\r\n    const dbName = mongoUri.split('/').pop()?.split('?')[0] || 'test';\r\n    console.log(`Using database: ${dbName}`);\r\n\r\n    const db = client.db(dbName);\r\n    const categoriesCollection = db.collection('categories');\r\n\r\n    // List all indexes\r\n    console.log('Current indexes:');\r\n    const indexes = await categoriesCollection.listIndexes().toArray();\r\n    console.log(JSON.stringify(indexes, null, 2));\r\n\r\n    // Drop all indexes except _id index\r\n    for (const index of indexes) {\r\n      if (index.name !== '_id_') {\r\n        try {\r\n          console.log(`Dropping index: ${index.name}`);\r\n          await categoriesCollection.dropIndex(index.name);\r\n          console.log(`Successfully dropped index: ${index.name}`);\r\n        } catch (err) {\r\n          console.error(`Error dropping index ${index.name}:`, err.message);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Create new index on name field\r\n    try {\r\n      console.log('Creating new index on name field');\r\n      await categoriesCollection.createIndex({ name: 1 }, { unique: true });\r\n      console.log('Successfully created name index');\r\n    } catch (err) {\r\n      console.error('Error creating name index:', err.message);\r\n    }\r\n\r\n    // Verify indexes after changes\r\n    console.log('Updated indexes:');\r\n    const updatedIndexes = await categoriesCollection.listIndexes().toArray();\r\n    console.log(JSON.stringify(updatedIndexes, null, 2));\r\n  } catch (error) {\r\n    console.error('Error:', error);\r\n  } finally {\r\n    await client.close();\r\n    console.log('Disconnected from MongoDB');\r\n  }\r\n}\r\n\r\n// Run the script\r\nfixMongoIndexes().catch(console.error);\r\n"],"names":["MongoClient","require","config","fixMongoIndexes","mongoUri","process","env","MONGODB_URI","console","log","client","connect","dbName","split","pop","db","categoriesCollection","collection","indexes","listIndexes","toArray","JSON","stringify","index","name","dropIndex","err","error","message","createIndex","unique","updatedIndexes","close","catch"],"mappings":";AAAA,8DAA8D;AAE9D,MAAM,EAAEA,WAAW,EAAE,GAAGC,QAAQ;AAChCA,QAAQ,UAAUC,MAAM;AAExB,eAAeC;IACb,wDAAwD;IACxD,MAAMC,WAAWC,QAAQC,GAAG,CAACC,WAAW,IAAI;IAC5CC,QAAQC,GAAG,CAAC,CAAC,yBAAyB,EAAEL,UAAU;IAElD,MAAMM,SAAS,IAAIV,YAAYI;IAE/B,IAAI;QACF,qBAAqB;QACrB,MAAMM,OAAOC,OAAO;QACpBH,QAAQC,GAAG,CAAC;QAEZ,2CAA2C;QAC3C,MAAMG,SAASR,SAASS,KAAK,CAAC,KAAKC,GAAG,IAAID,MAAM,IAAI,CAAC,EAAE,IAAI;QAC3DL,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEG,QAAQ;QAEvC,MAAMG,KAAKL,OAAOK,EAAE,CAACH;QACrB,MAAMI,uBAAuBD,GAAGE,UAAU,CAAC;QAE3C,mBAAmB;QACnBT,QAAQC,GAAG,CAAC;QACZ,MAAMS,UAAU,MAAMF,qBAAqBG,WAAW,GAAGC,OAAO;QAChEZ,QAAQC,GAAG,CAACY,KAAKC,SAAS,CAACJ,SAAS,MAAM;QAE1C,oCAAoC;QACpC,KAAK,MAAMK,SAASL,QAAS;YAC3B,IAAIK,MAAMC,IAAI,KAAK,QAAQ;gBACzB,IAAI;oBACFhB,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEc,MAAMC,IAAI,EAAE;oBAC3C,MAAMR,qBAAqBS,SAAS,CAACF,MAAMC,IAAI;oBAC/ChB,QAAQC,GAAG,CAAC,CAAC,4BAA4B,EAAEc,MAAMC,IAAI,EAAE;gBACzD,EAAE,OAAOE,KAAK;oBACZlB,QAAQmB,KAAK,CAAC,CAAC,qBAAqB,EAAEJ,MAAMC,IAAI,CAAC,CAAC,CAAC,EAAEE,IAAIE,OAAO;gBAClE;YACF;QACF;QAEA,iCAAiC;QACjC,IAAI;YACFpB,QAAQC,GAAG,CAAC;YACZ,MAAMO,qBAAqBa,WAAW,CAAC;gBAAEL,MAAM;YAAE,GAAG;gBAAEM,QAAQ;YAAK;YACnEtB,QAAQC,GAAG,CAAC;QACd,EAAE,OAAOiB,KAAK;YACZlB,QAAQmB,KAAK,CAAC,8BAA8BD,IAAIE,OAAO;QACzD;QAEA,+BAA+B;QAC/BpB,QAAQC,GAAG,CAAC;QACZ,MAAMsB,iBAAiB,MAAMf,qBAAqBG,WAAW,GAAGC,OAAO;QACvEZ,QAAQC,GAAG,CAACY,KAAKC,SAAS,CAACS,gBAAgB,MAAM;IACnD,EAAE,OAAOJ,OAAO;QACdnB,QAAQmB,KAAK,CAAC,UAAUA;IAC1B,SAAU;QACR,MAAMjB,OAAOsB,KAAK;QAClBxB,QAAQC,GAAG,CAAC;IACd;AACF;AAEA,iBAAiB;AACjBN,kBAAkB8B,KAAK,CAACzB,QAAQmB,KAAK"}