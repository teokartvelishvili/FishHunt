{"version":3,"sources":["../../src/scripts/drop-code-index.ts"],"sourcesContent":["import { MongoClient } from 'mongodb';\r\nimport * as dotenv from 'dotenv';\r\n\r\n// Load environment variables\r\ndotenv.config();\r\n\r\nasync function dropCodeIndex() {\r\n  // Get the MongoDB URI from environment variables\r\n  const mongoUri = process.env.MONGODB_URI || 'mongodb://localhost:27017/test';\r\n  console.log(`Connecting to MongoDB at ${mongoUri}`);\r\n\r\n  // Create a new MongoDB client\r\n  const client = new MongoClient(mongoUri);\r\n\r\n  try {\r\n    // Connect to the MongoDB server\r\n    await client.connect();\r\n    console.log('Connected to MongoDB server');\r\n\r\n    // Extract database name from the connection string\r\n    const dbName = mongoUri.split('/').pop()?.split('?')[0] || 'test';\r\n    console.log(`Using database: ${dbName}`);\r\n\r\n    // Get a reference to the database\r\n    const db = client.db(dbName);\r\n\r\n    // Get a reference to the categories collection\r\n    const categoriesCollection = db.collection('categories');\r\n\r\n    // List all indexes in the collection\r\n    console.log('Current indexes:');\r\n    const indexes = await categoriesCollection.listIndexes().toArray();\r\n    console.log(JSON.stringify(indexes, null, 2));\r\n\r\n    // Find the code_1 index\r\n    const codeIndex = indexes.find(\r\n      (index) =>\r\n        index.name === 'code_1' ||\r\n        (index.key && Object.keys(index.key).includes('code')),\r\n    );\r\n\r\n    if (codeIndex) {\r\n      console.log(`Found code index to drop: ${codeIndex.name}`);\r\n      // Drop the code_1 index\r\n      await categoriesCollection.dropIndex(codeIndex.name);\r\n      console.log(`Successfully dropped index: ${codeIndex.name}`);\r\n    } else {\r\n      console.log('No code index found. Trying a direct drop by name.');\r\n\r\n      // Try to drop by name directly\r\n      try {\r\n        await categoriesCollection.dropIndex('code_1');\r\n        console.log('Successfully dropped index: code_1');\r\n      } catch (e) {\r\n        console.log(\r\n          'Failed to drop index by name, it might not exist:',\r\n          e.message,\r\n        );\r\n      }\r\n    }\r\n\r\n    // Create any needed indexes\r\n    try {\r\n      await categoriesCollection.createIndex({ name: 1 }, { unique: true });\r\n      console.log('Created index on name field');\r\n    } catch (e) {\r\n      console.log('Failed to create index on name field:', e.message);\r\n    }\r\n\r\n    // List updated indexes\r\n    console.log('Updated indexes:');\r\n    const updatedIndexes = await categoriesCollection.listIndexes().toArray();\r\n    console.log(JSON.stringify(updatedIndexes, null, 2));\r\n  } catch (error) {\r\n    console.error('Error:', error);\r\n  } finally {\r\n    // Close the connection\r\n    await client.close();\r\n    console.log('Disconnected from MongoDB');\r\n  }\r\n}\r\n\r\n// Run the function\r\ndropCodeIndex();\r\n"],"names":["dotenv","config","dropCodeIndex","mongoUri","process","env","MONGODB_URI","console","log","client","MongoClient","connect","dbName","split","pop","db","categoriesCollection","collection","indexes","listIndexes","toArray","JSON","stringify","codeIndex","find","index","name","key","Object","keys","includes","dropIndex","e","message","createIndex","unique","updatedIndexes","error","close"],"mappings":";;;;yBAA4B;gEACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAExB,6BAA6B;AAC7BA,QAAOC,MAAM;AAEb,eAAeC;IACb,iDAAiD;IACjD,MAAMC,WAAWC,QAAQC,GAAG,CAACC,WAAW,IAAI;IAC5CC,QAAQC,GAAG,CAAC,CAAC,yBAAyB,EAAEL,UAAU;IAElD,8BAA8B;IAC9B,MAAMM,SAAS,IAAIC,oBAAW,CAACP;IAE/B,IAAI;QACF,gCAAgC;QAChC,MAAMM,OAAOE,OAAO;QACpBJ,QAAQC,GAAG,CAAC;QAEZ,mDAAmD;QACnD,MAAMI,SAAST,SAASU,KAAK,CAAC,KAAKC,GAAG,IAAID,MAAM,IAAI,CAAC,EAAE,IAAI;QAC3DN,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEI,QAAQ;QAEvC,kCAAkC;QAClC,MAAMG,KAAKN,OAAOM,EAAE,CAACH;QAErB,+CAA+C;QAC/C,MAAMI,uBAAuBD,GAAGE,UAAU,CAAC;QAE3C,qCAAqC;QACrCV,QAAQC,GAAG,CAAC;QACZ,MAAMU,UAAU,MAAMF,qBAAqBG,WAAW,GAAGC,OAAO;QAChEb,QAAQC,GAAG,CAACa,KAAKC,SAAS,CAACJ,SAAS,MAAM;QAE1C,wBAAwB;QACxB,MAAMK,YAAYL,QAAQM,IAAI,CAC5B,CAACC,QACCA,MAAMC,IAAI,KAAK,YACdD,MAAME,GAAG,IAAIC,OAAOC,IAAI,CAACJ,MAAME,GAAG,EAAEG,QAAQ,CAAC;QAGlD,IAAIP,WAAW;YACbhB,QAAQC,GAAG,CAAC,CAAC,0BAA0B,EAAEe,UAAUG,IAAI,EAAE;YACzD,wBAAwB;YACxB,MAAMV,qBAAqBe,SAAS,CAACR,UAAUG,IAAI;YACnDnB,QAAQC,GAAG,CAAC,CAAC,4BAA4B,EAAEe,UAAUG,IAAI,EAAE;QAC7D,OAAO;YACLnB,QAAQC,GAAG,CAAC;YAEZ,+BAA+B;YAC/B,IAAI;gBACF,MAAMQ,qBAAqBe,SAAS,CAAC;gBACrCxB,QAAQC,GAAG,CAAC;YACd,EAAE,OAAOwB,GAAG;gBACVzB,QAAQC,GAAG,CACT,qDACAwB,EAAEC,OAAO;YAEb;QACF;QAEA,4BAA4B;QAC5B,IAAI;YACF,MAAMjB,qBAAqBkB,WAAW,CAAC;gBAAER,MAAM;YAAE,GAAG;gBAAES,QAAQ;YAAK;YACnE5B,QAAQC,GAAG,CAAC;QACd,EAAE,OAAOwB,GAAG;YACVzB,QAAQC,GAAG,CAAC,yCAAyCwB,EAAEC,OAAO;QAChE;QAEA,uBAAuB;QACvB1B,QAAQC,GAAG,CAAC;QACZ,MAAM4B,iBAAiB,MAAMpB,qBAAqBG,WAAW,GAAGC,OAAO;QACvEb,QAAQC,GAAG,CAACa,KAAKC,SAAS,CAACc,gBAAgB,MAAM;IACnD,EAAE,OAAOC,OAAO;QACd9B,QAAQ8B,KAAK,CAAC,UAAUA;IAC1B,SAAU;QACR,uBAAuB;QACvB,MAAM5B,OAAO6B,KAAK;QAClB/B,QAAQC,GAAG,CAAC;IACd;AACF;AAEA,mBAAmB;AACnBN"}