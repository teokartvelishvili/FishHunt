{"version":3,"sources":["../../src/scripts/replace-broken-images.js"],"sourcesContent":["const { MongoClient } = require('mongodb');\r\n\r\nconst PLACEHOLDER_IMAGE =\r\n  'https://res.cloudinary.com/dqbre9j3o/image/upload/v1765026400/ecommerce/h0s3zygdovjif8dkepty.jpg';\r\n\r\n// These are the broken image IDs that return 404\r\nconst BROKEN_IMAGE_IDS = [\r\n  'iepgkawjlafrbfnqisel',\r\n  'regrzcwcnom9au8kuntj',\r\n  'ulmb5ivtkfgh1tdbffwn',\r\n  'oedqsaybuajgyjcppvbm',\r\n  'zty4vxnz9oqyfymmkcys',\r\n  'ugv0tpmknjynhi2ewnb8',\r\n  'hewoyp76cfqccykiliuc',\r\n  'zyr4v8qxpxvjrqw10vhk',\r\n  'a1d7msjewxxvuxntbklf',\r\n  'giepij2twbxmppmie14a',\r\n  'sqyioz3myozha58mjufe',\r\n  'cwvqmllh4zpvomureswl',\r\n  'yzwnys7cz125uxxssq4e',\r\n  'ugpjd7hbxpk7l7rghejw',\r\n  'axeobhuv6lqykrqfi8dv',\r\n  'qtdleofi37qirrd5nxnv',\r\n];\r\n\r\nasync function run() {\r\n  const client = new MongoClient(\r\n    'mongodb+srv://fishhuntgeo:w4fc9PXQLDYwNUUe@ecommerce.ddxri.mongodb.net/?retryWrites=true&w=majority',\r\n  );\r\n\r\n  try {\r\n    await client.connect();\r\n    console.log('Connected to MongoDB');\r\n\r\n    const db = client.db('test');\r\n    const collections = [\r\n      'products',\r\n      'banners',\r\n      'orders',\r\n      'carts',\r\n      'users',\r\n      'categories',\r\n      'subcategories',\r\n    ];\r\n\r\n    for (const colName of collections) {\r\n      const collection = db.collection(colName);\r\n      const docs = await collection.find({}).toArray();\r\n      let count = 0;\r\n\r\n      for (const doc of docs) {\r\n        const originalId = doc._id;\r\n        let str = JSON.stringify(doc);\r\n        let hasChanges = false;\r\n\r\n        // Check if any broken image ID exists in this document\r\n        for (const brokenId of BROKEN_IMAGE_IDS) {\r\n          if (str.includes(brokenId)) {\r\n            // Replace any URL containing this broken image ID with the placeholder\r\n            const regex = new RegExp(\r\n              `https://res\\\\.cloudinary\\\\.com/[^/]+/image/upload/[^\"]*${brokenId}[^\"]*`,\r\n              'g',\r\n            );\r\n            str = str.replace(regex, PLACEHOLDER_IMAGE);\r\n            hasChanges = true;\r\n          }\r\n        }\r\n\r\n        if (hasChanges) {\r\n          const newDoc = JSON.parse(str);\r\n          delete newDoc._id;\r\n          await collection.updateOne({ _id: originalId }, { $set: newDoc });\r\n          count++;\r\n        }\r\n      }\r\n\r\n      if (count > 0) {\r\n        console.log(`${colName}: ${count} documents updated`);\r\n      }\r\n    }\r\n\r\n    console.log('Done!');\r\n  } catch (error) {\r\n    console.error('Error:', error);\r\n  } finally {\r\n    await client.close();\r\n  }\r\n}\r\n\r\nrun();\r\n"],"names":["MongoClient","require","PLACEHOLDER_IMAGE","BROKEN_IMAGE_IDS","run","client","connect","console","log","db","collections","colName","collection","docs","find","toArray","count","doc","originalId","_id","str","JSON","stringify","hasChanges","brokenId","includes","regex","RegExp","replace","newDoc","parse","updateOne","$set","error","close"],"mappings":";AAAA,MAAM,EAAEA,WAAW,EAAE,GAAGC,QAAQ;AAEhC,MAAMC,oBACJ;AAEF,iDAAiD;AACjD,MAAMC,mBAAmB;IACvB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,eAAeC;IACb,MAAMC,SAAS,IAAIL,YACjB;IAGF,IAAI;QACF,MAAMK,OAAOC,OAAO;QACpBC,QAAQC,GAAG,CAAC;QAEZ,MAAMC,KAAKJ,OAAOI,EAAE,CAAC;QACrB,MAAMC,cAAc;YAClB;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,KAAK,MAAMC,WAAWD,YAAa;YACjC,MAAME,aAAaH,GAAGG,UAAU,CAACD;YACjC,MAAME,OAAO,MAAMD,WAAWE,IAAI,CAAC,CAAC,GAAGC,OAAO;YAC9C,IAAIC,QAAQ;YAEZ,KAAK,MAAMC,OAAOJ,KAAM;gBACtB,MAAMK,aAAaD,IAAIE,GAAG;gBAC1B,IAAIC,MAAMC,KAAKC,SAAS,CAACL;gBACzB,IAAIM,aAAa;gBAEjB,uDAAuD;gBACvD,KAAK,MAAMC,YAAYrB,iBAAkB;oBACvC,IAAIiB,IAAIK,QAAQ,CAACD,WAAW;wBAC1B,uEAAuE;wBACvE,MAAME,QAAQ,IAAIC,OAChB,CAAC,uDAAuD,EAAEH,SAAS,KAAK,CAAC,EACzE;wBAEFJ,MAAMA,IAAIQ,OAAO,CAACF,OAAOxB;wBACzBqB,aAAa;oBACf;gBACF;gBAEA,IAAIA,YAAY;oBACd,MAAMM,SAASR,KAAKS,KAAK,CAACV;oBAC1B,OAAOS,OAAOV,GAAG;oBACjB,MAAMP,WAAWmB,SAAS,CAAC;wBAAEZ,KAAKD;oBAAW,GAAG;wBAAEc,MAAMH;oBAAO;oBAC/Db;gBACF;YACF;YAEA,IAAIA,QAAQ,GAAG;gBACbT,QAAQC,GAAG,CAAC,GAAGG,QAAQ,EAAE,EAAEK,MAAM,kBAAkB,CAAC;YACtD;QACF;QAEAT,QAAQC,GAAG,CAAC;IACd,EAAE,OAAOyB,OAAO;QACd1B,QAAQ0B,KAAK,CAAC,UAAUA;IAC1B,SAAU;QACR,MAAM5B,OAAO6B,KAAK;IACpB;AACF;AAEA9B"}