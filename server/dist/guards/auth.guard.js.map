{"version":3,"sources":["../../src/guards/auth.guard.ts"],"sourcesContent":["import { CanActivate, ExecutionContext, Injectable, UnauthorizedException } from \"@nestjs/common\";\r\nimport { JwtService } from \"@nestjs/jwt\";\r\nimport { Observable } from \"rxjs\";\r\n\r\n@Injectable()\r\nexport class AuthGuard implements CanActivate{\r\n\r\n  constructor(\r\n    private jwtService: JwtService\r\n  ){}\r\n\r\n  async canActivate(context: ExecutionContext): Promise<boolean>{\r\n\r\n    const request = context.switchToHttp().getRequest()\r\n\r\n    const token = this.getToken(request.headers)\r\n\r\n    if(!token) throw new UnauthorizedException()\r\n\r\n    try{\r\n      const payLoad = await this.jwtService.verify(token)\r\n      request.userId = payLoad.userId\r\n      request.role = payLoad.role\r\n    }catch(e){\r\n      throw new UnauthorizedException()\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  getToken(headers){\r\n    if(!headers['authorization']) return null\r\n    const [type, token] = headers['authorization'].split(' ')\r\n    return type === 'Bearer' ? token : null\r\n  }\r\n\r\n}\r\n"],"names":["AuthGuard","canActivate","context","request","switchToHttp","getRequest","token","getToken","headers","UnauthorizedException","payLoad","jwtService","verify","userId","role","e","type","split"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBALoE;qBACtD;;;;;;;;;;AAIpB,IAAA,AAAMA,YAAN,MAAMA;IAMX,MAAMC,YAAYC,OAAyB,EAAmB;QAE5D,MAAMC,UAAUD,QAAQE,YAAY,GAAGC,UAAU;QAEjD,MAAMC,QAAQ,IAAI,CAACC,QAAQ,CAACJ,QAAQK,OAAO;QAE3C,IAAG,CAACF,OAAO,MAAM,IAAIG,6BAAqB;QAE1C,IAAG;YACD,MAAMC,UAAU,MAAM,IAAI,CAACC,UAAU,CAACC,MAAM,CAACN;YAC7CH,QAAQU,MAAM,GAAGH,QAAQG,MAAM;YAC/BV,QAAQW,IAAI,GAAGJ,QAAQI,IAAI;QAC7B,EAAC,OAAMC,GAAE;YACP,MAAM,IAAIN,6BAAqB;QACjC;QAEA,OAAO;IACT;IAEAF,SAASC,OAAO,EAAC;QACf,IAAG,CAACA,OAAO,CAAC,gBAAgB,EAAE,OAAO;QACrC,MAAM,CAACQ,MAAMV,MAAM,GAAGE,OAAO,CAAC,gBAAgB,CAACS,KAAK,CAAC;QACrD,OAAOD,SAAS,WAAWV,QAAQ;IACrC;IA3BA,YACE,AAAQK,UAAsB,CAC/B;aADSA,aAAAA;IACR;AA2BJ"}