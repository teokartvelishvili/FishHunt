{"version":3,"sources":["../../src/payments/payments.controller.ts"],"sourcesContent":["import { Controller, Post, Body, Get, Param } from '@nestjs/common';\r\nimport { PaymentsService } from './payments.service';\r\n\r\n@Controller('payments')\r\nexport class PaymentsController {\r\n  constructor(private readonly paymentsService: PaymentsService) {}\r\n\r\n  @Post('bog/create')\r\n  async createBogPayment(@Body() data: any) {\r\n    try {\r\n      const result = await this.paymentsService.createPayment(data);\r\n\r\n      // Update order with external_order_id for callback processing\r\n      if (result.uniqueId && data.product?.productId) {\r\n        try {\r\n          await this.paymentsService.updateOrderWithExternalId(\r\n            data.product.productId,\r\n            result.uniqueId,\r\n          );\r\n        } catch (error) {\r\n          console.error('Failed to update order with external ID:', error);\r\n          // Continue with payment creation even if this fails\r\n        }\r\n      }\r\n\r\n      return result;\r\n    } catch (error) {\r\n      console.error('BOG Payment Error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  @Get('bog/status/:orderId')\r\n  async getBogPaymentStatus(@Param('orderId') orderId: string) {\r\n    return this.paymentsService.getPaymentStatus(orderId);\r\n  }\r\n\r\n  @Post('bog/callback')\r\n  async handleBogCallback(@Body() data: any) {\r\n    console.log('BOG Payment Callback endpoint hit');\r\n    console.log('Callback data received:', JSON.stringify(data, null, 2));\r\n\r\n    const result = await this.paymentsService.handlePaymentCallback(data);\r\n\r\n    console.log('Callback processing result:', JSON.stringify(result, null, 2));\r\n\r\n    return {\r\n      status: result.success ? 'success' : 'failed',\r\n      message: result.message,\r\n    };\r\n  }\r\n}\r\n"],"names":["PaymentsController","createBogPayment","data","result","paymentsService","createPayment","uniqueId","product","productId","updateOrderWithExternalId","error","console","getBogPaymentStatus","orderId","getPaymentStatus","handleBogCallback","log","JSON","stringify","handlePaymentCallback","status","success","message"],"mappings":";;;;+BAIaA;;;eAAAA;;;wBAJsC;iCACnB;;;;;;;;;;;;;;;AAGzB,IAAA,AAAMA,qBAAN,MAAMA;IAGX,MACMC,iBAAiB,AAAQC,IAAS,EAAE;QACxC,IAAI;YACF,MAAMC,SAAS,MAAM,IAAI,CAACC,eAAe,CAACC,aAAa,CAACH;YAExD,8DAA8D;YAC9D,IAAIC,OAAOG,QAAQ,IAAIJ,KAAKK,OAAO,EAAEC,WAAW;gBAC9C,IAAI;oBACF,MAAM,IAAI,CAACJ,eAAe,CAACK,yBAAyB,CAClDP,KAAKK,OAAO,CAACC,SAAS,EACtBL,OAAOG,QAAQ;gBAEnB,EAAE,OAAOI,OAAO;oBACdC,QAAQD,KAAK,CAAC,4CAA4CA;gBAC1D,oDAAoD;gBACtD;YACF;YAEA,OAAOP;QACT,EAAE,OAAOO,OAAO;YACdC,QAAQD,KAAK,CAAC,sBAAsBA;YACpC,MAAMA;QACR;IACF;IAEA,MACME,oBAAoB,AAAkBC,OAAe,EAAE;QAC3D,OAAO,IAAI,CAACT,eAAe,CAACU,gBAAgB,CAACD;IAC/C;IAEA,MACME,kBAAkB,AAAQb,IAAS,EAAE;QACzCS,QAAQK,GAAG,CAAC;QACZL,QAAQK,GAAG,CAAC,2BAA2BC,KAAKC,SAAS,CAAChB,MAAM,MAAM;QAElE,MAAMC,SAAS,MAAM,IAAI,CAACC,eAAe,CAACe,qBAAqB,CAACjB;QAEhES,QAAQK,GAAG,CAAC,+BAA+BC,KAAKC,SAAS,CAACf,QAAQ,MAAM;QAExE,OAAO;YACLiB,QAAQjB,OAAOkB,OAAO,GAAG,YAAY;YACrCC,SAASnB,OAAOmB,OAAO;QACzB;IACF;IA7CA,YAAY,AAAiBlB,eAAgC,CAAE;aAAlCA,kBAAAA;IAAmC;AA8ClE"}