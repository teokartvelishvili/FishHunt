{"version":3,"sources":["../../../src/products/schemas/product.schema.ts"],"sourcesContent":["import * as mongoose from 'mongoose';\r\nimport { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\r\nimport { User } from '../../users/schemas/user.schema';\r\nimport { HydratedDocument } from 'mongoose';\r\nimport { Category } from '../../categories/schemas/category.schema';\r\nimport { SubCategory } from '../../categories/schemas/subcategory.schema';\r\n\r\nexport type ProductDocument = HydratedDocument<Product>;\r\n\r\n@Schema({ timestamps: true })\r\nexport class Review {\r\n  @Prop({\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    required: true,\r\n    ref: 'User',\r\n    default: null,\r\n  })\r\n  user!: User;\r\n\r\n  @Prop({ required: true })\r\n  name!: string;\r\n\r\n  @Prop({ required: true })\r\n  rating!: number;\r\n\r\n  @Prop({ required: true })\r\n  comment!: string;\r\n}\r\n\r\nexport enum ProductStatus {\r\n  PENDING = 'PENDING',\r\n  APPROVED = 'APPROVED',\r\n  REJECTED = 'REJECTED',\r\n}\r\n\r\nexport enum DeliveryType {\r\n  SELLER = 'SELLER',\r\n  FishHunt = 'FishHunt',\r\n}\r\n\r\nexport enum MainCategory {\r\n  CLOTHING = 'CLOTHING',\r\n  ACCESSORIES = 'ACCESSORIES',\r\n  FOOTWEAR = 'FOOTWEAR',\r\n  SWIMWEAR = 'SWIMWEAR',\r\n}\r\n\r\nexport enum AgeGroup {\r\n  ADULTS = 'ADULTS',\r\n  KIDS = 'KIDS',\r\n}\r\n\r\nexport interface CategoryStructure {\r\n  main: MainCategory;\r\n  sub: string;\r\n  subEn?: string;\r\n  ageGroup?: AgeGroup;\r\n  size?: string;\r\n  color?: string;\r\n  colorEn?: string;\r\n}\r\n\r\n// New variant schema for tracking inventory by size/color\r\n@Schema()\r\nexport class ProductVariant {\r\n  @Prop({ required: false })\r\n  size?: string;\r\n\r\n  @Prop({ required: false })\r\n  color?: string;\r\n\r\n  @Prop({ required: false })\r\n  colorEn?: string;\r\n\r\n  @Prop({ required: false })\r\n  ageGroup?: string;\r\n\r\n  @Prop({ required: true, default: 0 })\r\n  stock: number;\r\n\r\n  @Prop({ required: false })\r\n  sku?: string;\r\n}\r\n\r\nexport const ProductVariantSchema =\r\n  SchemaFactory.createForClass(ProductVariant);\r\n\r\n@Schema({\r\n  timestamps: true,\r\n  autoIndex: false, // Disable automatic index creation\r\n})\r\nexport class Product {\r\n  @Prop({\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    required: true,\r\n    ref: 'User',\r\n    default: null,\r\n  })\r\n  user!: User;\r\n\r\n  @Prop({ required: true })\r\n  name!: string;\r\n\r\n  @Prop({ required: false })\r\n  nameEn?: string;\r\n\r\n  @Prop({ required: true })\r\n  brand?: string;\r\n\r\n  @Prop({})\r\n  brandLogo?: string;\r\n\r\n  // Legacy category field (keeping for backward compatibility)\r\n  @Prop({ required: true })\r\n  category!: string;\r\n\r\n  // New category relationships\r\n  @Prop({\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'Category',\r\n  })\r\n  mainCategory?: mongoose.Types.ObjectId | string;\r\n\r\n  @Prop()\r\n  mainCategoryEn?: string;\r\n\r\n  @Prop({\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'SubCategory',\r\n  })\r\n  subCategory?: mongoose.Types.ObjectId | string;\r\n\r\n  @Prop()\r\n  subCategoryEn?: string;\r\n\r\n  // Product attributes based on subcategory\r\n  @Prop({ type: [String], default: [] })\r\n  ageGroups?: string[];\r\n\r\n  @Prop({ type: [String], default: [] })\r\n  sizes?: string[];\r\n\r\n  @Prop({ type: [String], default: [] })\r\n  colors?: string[];\r\n\r\n  @Prop({ type: [String], default: [] })\r\n  colorsEn?: string[];\r\n\r\n  // Add categoryStructure field\r\n  @Prop({ type: Object })\r\n  categoryStructure?: CategoryStructure;\r\n\r\n  @Prop({ required: true, type: [String], default: [] })\r\n  images!: string[];\r\n\r\n  @Prop({ required: true })\r\n  description!: string;\r\n\r\n  @Prop({ required: false })\r\n  descriptionEn?: string;\r\n\r\n  @Prop({ required: false })\r\n  videoDescription?: string; // YouTube embed code or URL\r\n\r\n  // SEO hashtags for better search visibility\r\n  @Prop({ type: [String], default: [] })\r\n  hashtags?: string[];\r\n\r\n  @Prop({ required: true })\r\n  reviews!: Review[];\r\n\r\n  @Prop({ required: true, default: 0 })\r\n  rating!: number;\r\n\r\n  @Prop({ required: true, default: 0 })\r\n  numReviews!: number;\r\n\r\n  @Prop({ required: true, default: 0 })\r\n  price!: number;\r\n\r\n  // Discount functionality\r\n  @Prop({ type: Number, min: 0, max: 100 })\r\n  discountPercentage?: number;\r\n\r\n  @Prop({ type: Date })\r\n  discountStartDate?: Date;\r\n\r\n  @Prop({ type: Date })\r\n  discountEndDate?: Date;\r\n\r\n  // Legacy single inventory field (keeping for backward compatibility)\r\n  @Prop({ required: true, default: 0 })\r\n  countInStock!: number;\r\n\r\n  // New inventory tracking by variants\r\n  @Prop({ type: [ProductVariantSchema], default: [] })\r\n  variants: ProductVariant[];\r\n\r\n  @Prop({ required: true, default: ProductStatus.PENDING })\r\n  status!: ProductStatus;\r\n\r\n  @Prop({ type: String })\r\n  rejectionReason?: string;\r\n\r\n  @Prop({ type: String, enum: DeliveryType, default: DeliveryType.FishHunt })\r\n  deliveryType?: DeliveryType;\r\n\r\n  @Prop({ type: Number })\r\n  minDeliveryDays?: number;\r\n\r\n  @Prop({ type: Number })\r\n  maxDeliveryDays?: number;\r\n\r\n  @Prop({ type: Object })\r\n  dimensions?: {\r\n    width?: number;\r\n    height?: number;\r\n    depth?: number;\r\n  };\r\n}\r\n\r\nexport const ProductSchema = SchemaFactory.createForClass(Product);\r\n\r\n// Disable automatic index creation to prevent duplicates\r\nProductSchema.set('autoIndex', false);\r\n\r\n// Create indexes manually with proper configuration\r\n// Note: autoIndex is disabled to prevent duplicate indexes\r\n\r\n// Create composite index for efficient category-based queries\r\nProductSchema.index(\r\n  { mainCategory: 1, subCategory: 1 },\r\n  { background: true, sparse: true },\r\n);\r\n\r\n// Individual indexes for common queries\r\nProductSchema.index({ brand: 1 }, { background: true, sparse: true });\r\nProductSchema.index({ status: 1 }, { background: true });\r\n// Note: createdAt index is automatically created by timestamps: true\r\n\r\n// Array field indexes (created individually to avoid parallel array indexing)\r\nProductSchema.index({ ageGroups: 1 }, { background: true, sparse: true });\r\nProductSchema.index({ sizes: 1 }, { background: true, sparse: true });\r\nProductSchema.index({ colors: 1 }, { background: true, sparse: true });\r\n"],"names":["AgeGroup","DeliveryType","MainCategory","Product","ProductSchema","ProductStatus","ProductVariant","ProductVariantSchema","Review","type","mongoose","Schema","Types","ObjectId","required","ref","default","timestamps","SchemaFactory","createForClass","String","Object","Number","min","max","Date","enum","autoIndex","set","index","mainCategory","subCategory","background","sparse","brand","status","ageGroups","sizes","colors"],"mappings":"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"}