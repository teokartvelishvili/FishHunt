{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import 'dotenv/config';\r\nimport { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app/app.module';\r\nimport { ValidationPipe, VersioningType } from '@nestjs/common';\r\nimport { NestExpressApplication } from '@nestjs/platform-express';\r\nimport { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';\r\nimport helmet from 'helmet';\r\nimport cookieParser from 'cookie-parser';\r\nimport { join } from 'path';\r\nimport * as fs from 'fs';\r\nimport * as express from 'express';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create<NestExpressApplication>(AppModule, {\r\n    logger: ['error', 'warn', 'debug', 'log', 'verbose'],\r\n  });\r\n\r\n  // Configure express middleware for larger file uploads\r\n  app.use(express.json({ limit: '50mb' }));\r\n  app.use(express.urlencoded({ limit: '50mb', extended: true }));\r\n  app.use(express.raw({ limit: '50mb' }));\r\n\r\n  app.use(helmet());\r\n  app.use(cookieParser());\r\n  app.enableCors({\r\n    origin: (origin, callback) => {\r\n      const allowedOrigins = [\r\n        'https://www.fishhunt.vercel.app',\r\n        'https://fishhunt.ge',\r\n        'https://www.fishhunt.ge',\r\n        'https://fishhunt.vercel.app',\r\n        'https://fishhunt.vercel.app/home',\r\n        'https://fishhunt-web.vercel.app',\r\n        'https://www.fishhunt-web.vercel.app',\r\n        'fishhunt-git-master-teokartvelishvilis-projects.vercel.app',\r\n        'fishhunt-muj5s8qno-teokartvelishvilis-projects.vercel.app',\r\n        'https://fishhunt-git-main-aberoshvilis-projects.vercel.app',\r\n        'https://fishhunt-aberoshvilis-projects.vercel.app',\r\n        'https://fishhunt-i2lkx.ondigitalocean.app',\r\n        'http://localhost:3000',\r\n        'https://localhost:3000',\r\n        'http://localhost:4000',\r\n        'https://localhost:4000',\r\n        // Add development URLs that might be used\r\n        'http://127.0.0.1:3000',\r\n        'https://127.0.0.1:3000',\r\n        'http://127.0.0.1:4000',\r\n        'https://127.0.0.1:4000',\r\n      ];\r\n\r\n      // Allow requests with no origin (like mobile apps, curl requests)\r\n      if (\r\n        !origin ||\r\n        allowedOrigins.indexOf(origin) !== -1 ||\r\n        origin.match(/localhost/) ||\r\n        origin.includes('.vercel.app') || // Allow all Vercel domains\r\n        origin.includes('.ondigitalocean.app') // Allow all Digital Ocean domains\r\n      ) {\r\n        callback(null, true);\r\n      } else {\r\n        console.warn(`CORS blocked origin: ${origin}`);\r\n        callback(new Error('Not allowed by CORS'), false);\r\n      }\r\n    },\r\n    methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],\r\n    credentials: true,\r\n    allowedHeaders: [\r\n      'Content-Type',\r\n      'Authorization',\r\n      'forum-id',\r\n      'Origin',\r\n      'Accept',\r\n      'X-Requested-With',\r\n      'Access-Control-Request-Method',\r\n      'Access-Control-Request-Headers',\r\n    ],\r\n    exposedHeaders: ['Content-Length', 'X-Kuma-Revision'],\r\n    preflightContinue: false,\r\n    optionsSuccessStatus: 204,\r\n  });\r\n\r\n  app.enableVersioning({\r\n    type: VersioningType.URI,\r\n    defaultVersion: '1',\r\n  });\r\n\r\n  app.useGlobalPipes(\r\n    new ValidationPipe({\r\n      whitelist: true,\r\n      transform: true,\r\n      forbidNonWhitelisted: true,\r\n      transformOptions: {\r\n        enableImplicitConversion: true,\r\n      },\r\n    }),\r\n  );\r\n  app.use('/favicon.ico', (req, res) => res.status(204).send());\r\n\r\n  // Setup static file serving for uploads\r\n  app.useStaticAssets(join(__dirname, '..', 'uploads'), {\r\n    prefix: '/uploads/',\r\n  });\r\n\r\n  // Make sure uploads directory exists\r\n  const uploadsDir = join(__dirname, '..', 'uploads');\r\n  const logosDir = join(uploadsDir, 'logos');\r\n\r\n  if (!fs.existsSync(uploadsDir)) {\r\n    fs.mkdirSync(uploadsDir, { recursive: true });\r\n  }\r\n\r\n  if (!fs.existsSync(logosDir)) {\r\n    fs.mkdirSync(logosDir, { recursive: true });\r\n  }\r\n\r\n  const config = new DocumentBuilder()\r\n    .setTitle('fishhunt  API')\r\n    .setDescription('fishhunt E-commerce REST API')\r\n    .setVersion('1.0')\r\n    .addBearerAuth()\r\n    .build();\r\n\r\n  const document = SwaggerModule.createDocument(app, config);\r\n  SwaggerModule.setup('docs', app, document); // დარწმუნდით, რომ როუტი არის '/docs'\r\n\r\n  app.enableShutdownHooks();\r\n\r\n  const port = process.env.PORT || 4000;\r\n  await app.listen(port, '0.0.0.0'); // ვერსელისთვის საჭიროა '0.0.0.0'\r\n\r\n  console.log(`Application is running on: http://localhost:${port}`);\r\n}\r\n\r\nbootstrap();\r\n"],"names":["bootstrap","app","NestFactory","create","AppModule","logger","use","express","json","limit","urlencoded","extended","raw","helmet","cookieParser","enableCors","origin","callback","allowedOrigins","indexOf","match","includes","console","warn","Error","methods","credentials","allowedHeaders","exposedHeaders","preflightContinue","optionsSuccessStatus","enableVersioning","type","VersioningType","URI","defaultVersion","useGlobalPipes","ValidationPipe","whitelist","transform","forbidNonWhitelisted","transformOptions","enableImplicitConversion","req","res","status","send","useStaticAssets","join","__dirname","prefix","uploadsDir","logosDir","fs","existsSync","mkdirSync","recursive","config","DocumentBuilder","setTitle","setDescription","setVersion","addBearerAuth","build","document","SwaggerModule","createDocument","setup","enableShutdownHooks","port","process","env","PORT","listen","log"],"mappings":"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"}