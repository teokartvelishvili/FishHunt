{"version":3,"sources":["../../../src/orders/schemas/order.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\r\nimport * as mongoose from 'mongoose';\r\nimport { OrderItem, PaymentResult, ShippingDetails } from 'src/interfaces';\r\nimport { User } from 'src/users/schemas/user.schema';\r\n\r\nexport type OrderDocument = Order & mongoose.Document;\r\n\r\n@Schema({ timestamps: true })\r\nexport class Order {\r\n  @Prop({ type: mongoose.Schema.Types.ObjectId, required: true, ref: 'User' })\r\n  user!: User;\r\n\r\n  @Prop({\r\n    required: true,\r\n    type: [\r\n      {\r\n        name: { required: true, type: String },\r\n        nameEn: { required: false, type: String },\r\n        qty: { required: true, type: Number },\r\n        image: { required: true, type: String },\r\n        price: { required: true, type: Number },\r\n        size: { required: false, type: String },\r\n        color: { required: false, type: String },\r\n        ageGroup: { required: false, type: String },\r\n        productId: {\r\n          type: mongoose.Schema.Types.ObjectId,\r\n          required: true,\r\n          ref: 'Product',\r\n        },\r\n        product: {\r\n          type: {\r\n            deliveryType: { type: String }, // Use String type instead of enum\r\n            minDeliveryDays: { type: Number },\r\n            maxDeliveryDays: { type: Number },\r\n            dimensions: {\r\n              type: {\r\n                width: { type: Number },\r\n                height: { type: Number },\r\n                depth: { type: Number },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    ],\r\n  })\r\n  orderItems!: OrderItem[];\r\n\r\n  @Prop({\r\n    required: true,\r\n    type: {\r\n      address: { required: true, type: String },\r\n      city: { required: true, type: String },\r\n      postalCode: { required: true, type: String },\r\n      country: { required: true, type: String },\r\n    },\r\n  })\r\n  shippingDetails!: ShippingDetails;\r\n\r\n  @Prop({ required: true })\r\n  paymentMethod!: string;\r\n\r\n  @Prop({\r\n    required: false,\r\n    type: {\r\n      id: { required: true, type: String },\r\n      status: { required: true, type: String },\r\n      update_time: { required: true, type: String },\r\n      email_address: { required: true, type: String },\r\n    },\r\n  })\r\n  paymentResult!: PaymentResult;\r\n\r\n  @Prop({ required: true, default: 0.0 })\r\n  taxPrice!: number;\r\n\r\n  @Prop({ required: true, default: 0.0 })\r\n  shippingPrice!: number;\r\n\r\n  @Prop({ required: true, default: 0.0 })\r\n  itemsPrice!: number;\r\n\r\n  @Prop({ required: true, default: 0.0 })\r\n  totalPrice!: number;\r\n\r\n  @Prop({ default: false })\r\n  isPaid!: boolean;\r\n\r\n  @Prop({ required: false })\r\n  paidAt!: string;\r\n\r\n  @Prop({ default: false })\r\n  isDelivered!: boolean;\r\n\r\n  @Prop({ required: false })\r\n  deliveredAt!: string;\r\n\r\n  @Prop({ required: false })\r\n  cancelledAt!: Date;\r\n\r\n  @Prop({ required: false, unique: true, sparse: true })\r\n  externalOrderId!: string;\r\n\r\n  @Prop({\r\n    type: String,\r\n    enum: ['pending', 'paid', 'delivered', 'cancelled'],\r\n    default: 'pending',\r\n  })\r\n  status!: string;\r\n\r\n  @Prop({ required: false })\r\n  statusReason!: string;\r\n\r\n  @Prop({\r\n    type: Date,\r\n    default: () => new Date(Date.now() + 10 * 60 * 1000), // 10 minutes from now\r\n    // Removed TTL index - we handle expiration manually via cron job\r\n  })\r\n  stockReservationExpires!: Date;\r\n}\r\n\r\nexport const OrderSchema = SchemaFactory.createForClass(Order);\r\n"],"names":["Order","OrderSchema","type","mongoose","Schema","Types","ObjectId","required","ref","name","String","nameEn","qty","Number","image","price","size","color","ageGroup","productId","product","deliveryType","minDeliveryDays","maxDeliveryDays","dimensions","width","height","depth","address","city","postalCode","country","id","status","update_time","email_address","default","unique","sparse","enum","Date","now","timestamps","SchemaFactory","createForClass"],"mappings":";;;;;;;;;;;QAQaA;eAAAA;;QAiHAC;eAAAA;;;0BAzH+B;mEAClB;4BACgC;4BACrC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKd,IAAA,AAAMD,QAAN,MAAMA;AA+Gb;;;QA9GUE,MAAMC,WAASC,MAAM,CAACC,KAAK,CAACC,QAAQ;QAAEC,UAAU;QAAMC,KAAK;;;;;;QAIjED,UAAU;QACVL,MAAM;YACJ;gBACEO,MAAM;oBAAEF,UAAU;oBAAML,MAAMQ;gBAAO;gBACrCC,QAAQ;oBAAEJ,UAAU;oBAAOL,MAAMQ;gBAAO;gBACxCE,KAAK;oBAAEL,UAAU;oBAAML,MAAMW;gBAAO;gBACpCC,OAAO;oBAAEP,UAAU;oBAAML,MAAMQ;gBAAO;gBACtCK,OAAO;oBAAER,UAAU;oBAAML,MAAMW;gBAAO;gBACtCG,MAAM;oBAAET,UAAU;oBAAOL,MAAMQ;gBAAO;gBACtCO,OAAO;oBAAEV,UAAU;oBAAOL,MAAMQ;gBAAO;gBACvCQ,UAAU;oBAAEX,UAAU;oBAAOL,MAAMQ;gBAAO;gBAC1CS,WAAW;oBACTjB,MAAMC,WAASC,MAAM,CAACC,KAAK,CAACC,QAAQ;oBACpCC,UAAU;oBACVC,KAAK;gBACP;gBACAY,SAAS;oBACPlB,MAAM;wBACJmB,cAAc;4BAAEnB,MAAMQ;wBAAO;wBAC7BY,iBAAiB;4BAAEpB,MAAMW;wBAAO;wBAChCU,iBAAiB;4BAAErB,MAAMW;wBAAO;wBAChCW,YAAY;4BACVtB,MAAM;gCACJuB,OAAO;oCAAEvB,MAAMW;gCAAO;gCACtBa,QAAQ;oCAAExB,MAAMW;gCAAO;gCACvBc,OAAO;oCAAEzB,MAAMW;gCAAO;4BACxB;wBACF;oBACF;gBACF;YACF;SACD;;;;;;QAKDN,UAAU;QACVL,MAAM;YACJ0B,SAAS;gBAAErB,UAAU;gBAAML,MAAMQ;YAAO;YACxCmB,MAAM;gBAAEtB,UAAU;gBAAML,MAAMQ;YAAO;YACrCoB,YAAY;gBAAEvB,UAAU;gBAAML,MAAMQ;YAAO;YAC3CqB,SAAS;gBAAExB,UAAU;gBAAML,MAAMQ;YAAO;QAC1C;;;;;;QAIMH,UAAU;;;;;;QAIhBA,UAAU;QACVL,MAAM;YACJ8B,IAAI;gBAAEzB,UAAU;gBAAML,MAAMQ;YAAO;YACnCuB,QAAQ;gBAAE1B,UAAU;gBAAML,MAAMQ;YAAO;YACvCwB,aAAa;gBAAE3B,UAAU;gBAAML,MAAMQ;YAAO;YAC5CyB,eAAe;gBAAE5B,UAAU;gBAAML,MAAMQ;YAAO;QAChD;;;;;;QAIMH,UAAU;QAAM6B,SAAS;;;;;;QAGzB7B,UAAU;QAAM6B,SAAS;;;;;;QAGzB7B,UAAU;QAAM6B,SAAS;;;;;;QAGzB7B,UAAU;QAAM6B,SAAS;;;;;;QAGzBA,SAAS;;;;;;QAGT7B,UAAU;;;;;;QAGV6B,SAAS;;;;;;QAGT7B,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;QAAO8B,QAAQ;QAAMC,QAAQ;;;;;;QAI7CpC,MAAMQ;QACN6B,MAAM;YAAC;YAAW;YAAQ;YAAa;SAAY;QACnDH,SAAS;;;;;;QAIH7B,UAAU;;;;;;QAIhBL,MAAMsC;QACNJ,SAAS,IAAM,IAAII,KAAKA,KAAKC,GAAG,KAAK,KAAK,KAAK;;;;;;QA5GzCC,YAAY;;;AAkHf,MAAMzC,cAAc0C,uBAAa,CAACC,cAAc,CAAC5C"}