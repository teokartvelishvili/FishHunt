{"version":3,"sources":["../../src/strategies/jwt.strategy.ts"],"sourcesContent":["import { ExtractJwt, Strategy } from 'passport-jwt';\r\nimport { PassportStrategy } from '@nestjs/passport';\r\nimport { Injectable, UnauthorizedException } from '@nestjs/common';\r\nimport { UsersService } from 'src/users/services/users.service';\r\nimport { TokenPayload } from '../users/dtos/auth.dto';\r\n\r\n@Injectable()\r\nexport class JwtStrategy extends PassportStrategy(Strategy) {\r\n  constructor(private usersService: UsersService) {\r\n    super({\r\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n      ignoreExpiration: false,\r\n      secretOrKey: process.env.JWT_ACCESS_SECRET,\r\n    });\r\n  }\r\n\r\n  async validate(payload: TokenPayload) {\r\n    if (payload.type !== 'access') {\r\n      throw new UnauthorizedException('Invalid token type');\r\n    }\r\n\r\n    const user = await this.usersService.findById(payload.sub);\r\n\r\n    if (!user) {\r\n      throw new UnauthorizedException();\r\n    }\r\n\r\n    return user;\r\n  }\r\n}\r\n"],"names":["JwtStrategy","PassportStrategy","Strategy","validate","payload","type","UnauthorizedException","user","usersService","findById","sub","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","ignoreExpiration","secretOrKey","process","env","JWT_ACCESS_SECRET"],"mappings":";;;;+BAOaA;;;eAAAA;;;6BAPwB;0BACJ;wBACiB;8BACrB;;;;;;;;;;AAItB,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,IAAAA,0BAAgB,EAACC,qBAAQ;IASxD,MAAMC,SAASC,OAAqB,EAAE;QACpC,IAAIA,QAAQC,IAAI,KAAK,UAAU;YAC7B,MAAM,IAAIC,6BAAqB,CAAC;QAClC;QAEA,MAAMC,OAAO,MAAM,IAAI,CAACC,YAAY,CAACC,QAAQ,CAACL,QAAQM,GAAG;QAEzD,IAAI,CAACH,MAAM;YACT,MAAM,IAAID,6BAAqB;QACjC;QAEA,OAAOC;IACT;IApBA,YAAY,AAAQC,YAA0B,CAAE;QAC9C,KAAK,CAAC;YACJG,gBAAgBC,uBAAU,CAACC,2BAA2B;YACtDC,kBAAkB;YAClBC,aAAaC,QAAQC,GAAG,CAACC,iBAAiB;QAC5C,SALkBV,eAAAA;IAMpB;AAeF"}